var jQuery=window.jQuery||{};var Sheet=(function(e,l,g,b,n,q,r,h,c,o){var k=k||{};var a=null;k.ActionUI=(function(t,w,u,v,x){var y=function(G,M,D,H,A,O){this.enclosure=G;this.pane=M;this.sheet=D;this.max=O;this.xIndex=0;this.yIndex=0;this.scrollAxis={x:{},y:{}};this.scrollSize={};this.hiddenColumns=[];this.hiddenRows=[];if(!(this.frozenAt=A)){this.frozenAt={row:0,col:0}}this.frozenAt.row=u.max(this.frozenAt.row,0);this.frozenAt.col=u.max(this.frozenAt.col,0);this.scrolledArea={start:{row:u.max(this.frozenAt.row,1),col:u.max(this.frozenAt.col,1)},end:{row:u.max(this.frozenAt.row,1),col:u.max(this.frozenAt.col,1)}};if(k.ActionUI.prototype.nthCss===null){if(O){k.ActionUI.prototype.nthCss=function(T,aa,V,X,W){var Y=[],U=V.length,Z=this.repeat;W=W||"{display: none;}";do{if(V[U]>X){Y.push(aa+" "+T+":first-child"+Z("+"+T,V[U]-1))}}while(U--);if(Y.length){return Y.join(",")+W}return""}}else{k.ActionUI.prototype.nthCss=function(T,Z,V,X,W){var Y=[],U=V.length;W=W||"{display: none;}";do{if(V[U]>X){Y.push(Z+" "+T+":nth-child("+V[U]+")")}}while(U--);if(Y.length){return Y.join(",")+W}return""}}}var F=this,J="#"+D.getAttribute("id"),R=this.scrollUI=M.scrollOuter=t.createElement("div"),Q=M.scrollInner=t.createElement("div"),C=M.scrollStyleX=this.scrollStyleX=new k.StyleUpdater(function(T,U){T=T||[];if(T.length!==F.xIndex||U){F.xIndex=T.length||F.xIndex;U=U||E("col",J,T,F.frozenAt.col+1)+E("td",J+" tr",T,F.frozenAt.col+1);this.setStyle(U);if(T.length){F.scrolledArea.start.col=u.max(T.pop()||1,1);F.scrolledArea.end.col=u.max(T.shift()||1,1)}return true}return false}),B=M.scrollStyleY=this.scrollStyleY=new k.StyleUpdater(function(T,U){T=T||[];if(T.length!==F.yIndex||U){F.yIndex=T.length||F.yIndex;U=U||E("tr",J,T,F.frozenAt.row+1);this.setStyle(U);if(T.length){F.scrolledArea.start.row=u.max(T.pop()||1,1);F.scrolledArea.end.row=u.max(T.shift()||1,1)}return true}return false}),E=this.nthCss;R.setAttribute("class",H);R.appendChild(Q);x(R).disableSelectionSpecial();M.appendChild(C.styleElement);M.appendChild(B.styleElement);var P,S,L,K,I,N,z=D.tBody.children[0];M.resizeScroll=function(T){if(T){P=C.getStyle();S=B.getStyle()}else{P=(D.clientWidth<=G.clientWidth?"":C.getStyle());S=(D.clientHeight<=G.clientHeight?"":B.getStyle())}C.update(null," ");B.update(null," ");L=(z.clientWidth||D.clientWidth)+"px";K=D.clientHeight+"px";I=G.clientWidth+"px";N=G.clientHeight+"px";Q.style.width=L;Q.style.height=K;R.style.width=I;R.style.height=N;F.scrollStart("x");F.scrollStart("y");C.update(null,P);B.update(null,S);if(M.inPlaceEdit){M.inPlaceEdit.goToTd()}};new MouseWheel(M,R)};y.prototype={putTdInView:function(E){var A=0,z=0,D=0,C,B;this.xIndex=0;this.yIndex=0;while((C=this.directionToSeeTd(E))!==null){B=this.scrolledArea.end;if(C.left){z--;this.scrollTo({axis:"x",value:B.col-1});this.scrollStop()}else{if(C.right){z++;this.scrollTo({axis:"x",value:B.col+1});this.scrollStop()}}if(C.up){D--;this.scrollTo({axis:"y",value:B.row-1});this.scrollStop()}else{if(C.down){D++;this.scrollTo({axis:"y",value:B.row+1});this.scrollStop()}}A++;if(A<25){break}}},directionToSeeTd:function(A){var z=this.pane,J={top:0,bottom:z.clientHeight,left:0,right:z.clientWidth},F=A.clientWidth,D=A.clientHeight,H={top:A.offsetTop,bottom:A.offsetTop+D,left:A.offsetLeft,right:A.offsetLeft+F},B=A.parentNode,G=this.scrolledArea.end;if(!A.col){return null}var I=A.barTop.cellIndex<G.col,C=B.rowIndex<G.row,E={up:C,down:H.bottom>J.bottom&&D<=z.clientHeight,left:I,right:H.right>J.right&&F<=z.clientWidth};if(E.up||E.down||E.left||E.right){return E}return null},repeat:function(B,A){var z="";while(A>0){if(A&1){z+=B}A>>=1;B+=B}return z},nthCss:null,redraw:function(){var z=this.pane.style;z.opacity=0.9999;setTimeout(function(){z.opacity=1},0)},hide:function(A,H,K,C){var F=this,G="#"+this.sheet.getAttribute("id"),J=this.toggleHideStyleX=new k.StyleUpdater(function(){var L=z("col",G,F.hiddenColumns,0)+z("td",G+" tr",F.hiddenColumns,0);this.setStyle(L)}),I=this.toggleHideStyleY=new k.StyleUpdater(function(){var L=z("tr",G,F.hiddenRows,0);this.setStyle(L)}),E,D,z=this.nthCss,B=this.pane;B.appendChild(J.styleElement);B.appendChild(I.styleElement);this.hiddenRows=[];this.hiddenColumns=[];if(A){E=A.length-1;if(E>-1){do{D=A[E];this.toggleHideRow(K[D],D)}while(E--)}}if(H){E=H.length-1;if(E>-1){do{D=H[E];this.toggleHideColumn(C[D],D)}while(E--)}}},remove:function(){},scrollStart:function(E){var F=this.pane,C=F.scrollOuter,D=this.scrollAxis[E],B=this.scrollSize=this.sheet.size();D.v=[];D.name=E;jS.manScroll=false;switch(E||"x"){case"x":D.value=0;D.max=B.cols;D.min=0;D.size=B.cols;F.scrollStyleX.update();D.scrollStyle=F.scrollStyleX;D.area=C.scrollWidth-C.clientWidth;D.sheetArea=F.table.clientWidth-F.table.corner.clientWidth;D.scrollUpdate=function(){C.scrollLeft=(D.value)*(D.area/D.size);jS.manScroll=true};D.gridSize=100/D.size;break;case"y":D.value=0;D.max=B.rows;D.min=0;D.size=B.rows;F.scrollStyleY.update();D.scrollStyle=F.scrollStyleY;D.area=C.scrollHeight-C.clientHeight;D.sheetArea=F.table.clientHeight-F.table.corner.clientHeight;D.scrollUpdate=function(){C.scrollTop=(D.value)*(D.area/D.size);jS.manScroll=true};D.gridSize=100/D.size;break}var A=D.max;do{var z=new v(D.gridSize*A);z.index=A+1;D.v.unshift(z)}while(A--)},scrollTo:function(C){C=C||{};C.axis=C.axis||"x";C.value=C.value||0;C.pixel=C.pixel||0;if(!this.scrollAxis){this.scrollStart(C.axis)}var B=this.scrollAxis[C.axis];if(!C.value){C.value=u.round(u.abs(C.pixel/B.area)*10)}C.max=C.max||B.max;var A=((C.value>C.max?C.max:C.value)-B.min),z=[];if(A>=0){do{z.push(A+B.min)}while(A-->0)}B.value=C.value;if(z.length){if(B.scrollStyle){return B.scrollStyle.update(z)}}else{if(B.scrollStyle){return B.scrollStyle.update()}}return false},scrollStop:function(){if(this.scrollAxis.x.scrollUpdate){this.scrollAxis.x.scrollUpdate()}if(this.scrollAxis.y.scrollUpdate){this.scrollAxis.y.scrollUpdate()}},toggleHideRow:function(B,A){var z=x(B);A=u.max(A+1,1);if(z.length&&x.inArray(A,this.hiddenRows)<0){this.hiddenRows.push(A)}else{this.hiddenRows.splice(this.hiddenRows.indexOf(A),1)}this.toggleHideStyleY.update()},rowShowAll:function(){x.each(this.hiddenRows||[],function(z){x(this).removeData("hidden")});this.toggleHideStyleY.setStyle("");this.hiddenRows=[]},toggleHideColumn:function(z,A){var B=x(z);A=u.max(A+1,1);if(B.length&&x.inArray(A,this.hiddenColumns)<0){this.hiddenColumns.push(A)}else{this.hiddenColumns.splice(this.hiddenColumns.indexOf(A),1)}this.toggleHideStyleX.update()},columnShowAll:function(){this.toggleHideStyleX.setStyle("");this.hiddenColumns=[]}};return y})(l,g,h,q,e);k.StyleUpdater=(function(t){function u(v){var w=this.styleElement=t.createElement("style");w.styleUpdater=this;this.update=v}if(t.createElement("style").styleSheet){u.prototype={setStyle:function(w){var x=this.styleElement,v=x.styleSheet;v.disabled=false;if(!v.disabled){v.cssText=w}},getStyle:function(){var w=this.styleElement,v=w.styleSheet;v.disabled=false;if(!v.disabled){return v.cssText}return""}}}else{u.prototype={setStyle:function(v){this.styleElement.innerHTML=v},getStyle:function(){return this.styleElement.innerHTML}}}return u})(l);e.fn.extend({sheet:function(u){var v=isNaN,t=e.sheet.events;u=u||{};e(this).each(function(){var C=Globalize,z=e(this),B={editable:true,editableNames:true,barMenus:true,freezableCells:true,allowToggleState:true,menuLeft:null,menuRight:null,newColumnWidth:120,title:null,calcOff:false,lockFormulas:false,parent:z,colMargin:18,boxModelCorrection:2,formulaFunctions:{},formulaVariables:{},cellSelectModel:"excel",autoAddCells:true,resizableCells:true,resizableSheet:true,autoFiller:true,minSize:{rows:1,cols:1},error:function(D){return D.error},endOfNumber:false,encode:function(D){switch(typeof D){case"object":if(D.getMonth){return C.format(D,"d")}return D}if(!D){return D||""}if(!D.replace){return D||""}return D.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\n/g,"\n<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; ")},frozenAt:[],contextmenuTop:{"Toggle freeze columns to here":function(F){var D=F.getTdLocation(F.obj.tdActive()).col,E=F.obj.pane().actionUI;E.frozenAt.col=(E.frozenAt.col==D?0:D)},"Insert column after":function(D){D.controlFactory.addColumn(D.colLast);return false},"Insert column before":function(D){D.controlFactory.addColumn(D.colLast,true);return false},"Add column to end":function(D){D.controlFactory.addColumn();return false},"Delete this column":function(D){D.deleteColumn();return false},"Hide column":function(D){D.toggleHideColumn();return false}},contextmenuLeft:{"Toggle freeze rows to here":function(E){var F=E.getTdLocation(E.obj.tdActive()).row,D=E.obj.pane().actionUI;D.frozenAt.row=(D.frozenAt.row==F?0:F)},"Insert row after":function(D){D.controlFactory.addRow(D.rowLast);return false},"Insert row before":function(D){D.controlFactory.addRow(D.rowLast,true);return false},"Add row to end":function(D){D.controlFactory.addRow();return false},"Delete this row":function(D){D.deleteRow();return false},"Hide row":function(D){D.toggleHide.row();return false}},contextmenuCell:{Copy:false,Cut:false,"Insert column after":function(D){D.controlFactory.addColumn(D.colLast);return false},"Insert column before":function(D){D.controlFactory.addColumn(D.colLast,true);return false},"Add column to end":function(D){D.controlFactory.addColumn();return false},"Delete this column":function(D){D.deleteColumn();return false},line1:"line","Insert row after":function(D){D.controlFactory.addRow(D.rowLast);return false},"Insert row before":function(D){D.controlFactory.addRow(D.rowLast,true);return false},"Add row to end":function(D){D.controlFactory.addRow();return false},"Delete this row":function(D){D.deleteRow();return false},line2:"line","Add spreadsheet":function(D){D.addSheet()},"Delete spreadsheet":function(D){D.deleteSheet()}},hiddenRows:[],hiddenColumns:[],cellStartingHandlers:{"$":function(E,D){return m.DOLLAR.call(this,E.substring(1).replace(C.culture().numberFormat[","],""),2,D||"$")},"£":function(D){return A.s.cellStartingHandlers["$"].call(this,D,"£")}},cellEndHandlers:{"%":function(D){return D.substring(0,this.value.length-1)/100}},cellTypeHandlers:{percent:function(F){var E=(v(F)?C.parseFloat(F):F*1),D;if(!v(E)){D=new q(E);D.html=C.format(E,"p");return D}return F},date:function(E){var D=C.parseDate(E);if(!D){D=new b(typeof E==="string"?parseInt(E):E)}D.html=C.format(D,"d");return D},time:function(E){var D=C.parseDate(E);if(!D){D=new b(typeof E==="string"?parseInt(E):E)}D.html=C.format(D,"t");return D},currency:function(F){var E=(v(F)?C.parseFloat(F):F*1),D;if(!v(E)){D=new q(E);D.html=C.format(E,"c");return D}return F},number:function(F){var E,D;if(!u.endOfNumber){E=C.culture().numberFormat["."];u.endOfNumber=new c("(["+(E=="."?".":E)+"])([0-9]*?[1-9]+)?(0)*$")}if(!v(F)){D=new q(F);D.html=C.format(F+"","n10").replace(u.endOfNumber,function(I,H,G){return(G?H:"")+(G||"")});return D}return F}},alert:function(D){alert(D)},prompt:function(E,F,D){F(prompt(E,D))},confirm:function(F,D,E){if(confirm(F)){D()}else{if(E){E()}}},initCalcRows:40,initCalcCols:20};var A=this.jS;if(A){var x=z.children().detach();A.kill();z.html(x);for(var y in t){if(u[t[y]]){z.unbind(t[y])}}}if((this.className||"").match(/\bnotEditable\b/i)!=null){u.editable=false}for(var w in t){if(u[t[w]]){z.bind(t[w],u[t[w]])}}if(!e.sheet.instance.length){e.sheet.instance=[]}this.jS=A=e.sheet.createInstance(e.extend(B,u),e.sheet.instance.length);e.sheet.instance.push(A)});return this},disableSelectionSpecial:function(){this.each(function(){this.onselectstart=function(){return false};this.unselectable="on";this.style["-moz-user-select"]="none"});return this},getSheet:function(){var t=this[0],u=(t.jS||{});return u},getCellValue:function(y,u,t){var v=this[0],w=(v.jS||{});t=(t||0);if(w.updateCellValue){try{return w.updateCellValue(t,y,u)}catch(x){}}return null},setCellValue:function(y,A,v,u){var w=this[0],x=(w.jS||{}),t;u=(u||0);if(x.getCell&&(t=x.getCell(A,v,u))){try{if((y+"").charAt(0)=="="){t.valueOverride=t.value="";t.formula=y.substring(1)}else{t.value=y;t.valueOverride=t.formula=""}t.calcLast=t.calcDependenciesLast=0;x.updateCellValue.call(t);x.updateCellDependencies.call(t);return true}catch(z){}}return false},setCellFormula:function(A,z,v,u){var w=this[0],x=(w.jS||{}),t;u=(u||0);if(x.getCell&&(t=x.getCell(z,v,u))){try{t.formula=A;t.valueOverride=t.value="";t.calcLast=t.calcDependenciesLast=0;x.updateCellValue(u,z,v)}catch(y){}}return this},setCellHtml:function(w,A,v,u){var x=this[0],y=(x.jS||{}),t;u=(u||0);if(y.getCell&&(t=y.getCell(A,v,u))){try{t.html=[w];t.calcLast=t.calcDependenciesLast=0;y.updateCellValue(u,A,v)}catch(z){}}return this},isSheetFullScreen:function(){var t=this[0],u=(t.jS||{});if(u.obj){return u.obj.fullScreen().is(":visible")}return false},serializeCellInputs:function(u){var v=this[0],w=(v.jS||{}),t=w.obj.tables().find(":input");if(u){return t.serializeArray()}else{return t.serialize()}},viewSource:function(t){var u="";e(this).each(function(){if(t){u+=e(this).toPrettySource()}else{u+=e(this).toCompactSource()}});e.print(u);return u},saveSheet:function(){var t=jS.sheetDecorateRemove(true);var u=jQuery("<div />").html(t).html();jQuery.ajax({url:s.urlSave,type:"POST",data:"s="+u,dataType:"html",success:function(v){jS.setDirty(false);jS.trigger("saveSheet")}})},toCompactSource:function(){var x=this[0];var u="";if(x.nodeType==1){u+="<"+x.tagName.toLowerCase();var z=x.attributes.length;for(var w=0;w<z;w++){var v=x.attributes[w].name,y=x.getAttribute(v);if(y){if(v=="contentEditable"&&y=="inherit"){continue}if(typeof(y)=="string"){u+=" "+v+'="'+y.replace(/"/g,"'")+'"'}else{if(v=="style"&&y.cssText){u+=' style="'+y.cssText+'"'}}}}if(x.tagName=="COL"){u+="/>"}else{u+=">";var t="";e(x.childNodes).each(function(){t+=e(this).toCompactSource()});u+=t;u+="</"+x.tagName.toLowerCase()+">"}}else{if(x.nodeType==3){u+=x.data.replace(/^\s*(.*)\s*$/g,"$1")}}return u},toPrettySource:function(y){var x=this[0],A,w;y=y||"";var u="";if(x.nodeType==1){u+="\n"+y+"<"+x.tagName.toLowerCase();A=x.attributes.length;for(w=0;w<A;w++){var v=x.attributes[w].name,z=x.getAttribute(v);if(z){if(v=="contentEditable"&&z=="inherit"){continue}if(typeof(z)=="string"){u+=" "+v+'="'+e.trim(z.replace(/"/g,"'"))+'"'}else{if(v=="style"&&z.cssText){u+=' style="'+e.trim(z.cssText)+'"'}}}}if(x.childNodes.length<=0){if(x.tagName=="COL"){u+="/>"}else{u+="></"+x.tagName.toLowerCase()+">"}}else{u+=">";var t="";A=x.childNodes.length;for(w=0;w<A;w++){t+=e(x.childNodes[w]).toPrettySource(y+"  ")}u+=t;if(t.indexOf("\n")>=0){u+="\n"+y}u+="</"+x.tagName.toLowerCase()+">"}}else{if(x.nodeType==3){u+=x.data.replace(/^\s*(.*)\s*$/g,"$1")}}return u}});e.sheet={instance:[],dependencies:{coreCss:{css:"jquery.sheet.css"},formulaParser:{script:"parser/formula/formula.js"},tsvParser:{script:"parser/tsv/tsv.js"},jQueryUI:{script:"jquery-ui/jquery-ui.min.js",thirdParty:true},jQueryUIThemeRoller:{css:"jquery-ui/themes/smoothness/jquery-ui.min.css",thirdParty:true},globalize:{script:"globalize/lib/globalize.js",thirdParty:true},nearest:{script:"jquery-nearest/src/jquery.nearest.min.js",thirdParty:true},mousewheel:{script:"MouseWheel/MouseWheel.js",thirdParty:true}},optional:{advancedFn:{script:"plugins/jquery.sheet.advancedfn.js"},dts:{script:"plugins/jquery.sheet.dts.js"},financeFn:{script:"plugins/jquery.sheet.financefn.js"},colorPicker:{css:"really-simple-color-picker/colorPicker.css",script:"really-simple-color-picker/jquery.colorPicker.min.js",thirdParty:true},bitcoin:{script:"bitcoin.js",thirdParty:true},elastic:{script:"jquery-elastic/jquery.elastic.source.js",thirdParty:true},globalizeCultures:{script:"globalize/lib/cultures/globalize.cultures.js",thirdParty:true},raphael:{script:"raphael/raphael-min.js",thirdParty:true},gRaphael:{script:"graphael/g.raphael.js",thirdParty:true},gRaphaelBar:{script:"graphael/g.bar.js",thirdParty:true},gRaphaelDot:{script:"graphael/g.dot.js",thirdParty:true},gRaphaelLine:{script:"graphael/g.line.js",thirdParty:true},gRaphaelPie:{script:"graphael/g.pie.js",thirdParty:true},undoManager:{script:"Javascript-Undo-Manager/js/undomanager.js",thirdParty:true},zeroClipboard:{script:"zeroclipboard/dist/ZeroClipboard.min.js",thirdParty:true}},events:["sheetAddRow","sheetAddColumn","sheetSwitch","sheetRename","sheetTabSortStart","sheetTabSortUpdate","sheetCellEdit","sheetCellEdited","sheetCalculation","sheetAdd","sheetDelete","sheetDeleteRow","sheetDeleteColumn","sheetOpen","sheetAllOpened","sheetSave","sheetFullScreen","sheetFormulaKeydown"],preLoad:function(w,v){w=w||"";v=e.extend({skip:["globalizeCultures"],thirdPartyDirectory:"bower_components/"},v);var u=function(){if(this.script!==undefined){l.write('<script src="'+w+(this.thirdParty?v.thirdPartyDirectory:"")+this.script+'"><\/script>')}if(this.css!==undefined){l.write('<link rel="stylesheet" type="text/css" href="'+w+(this.thirdParty?v.thirdPartyDirectory:"")+this.css+'"></link>')}};for(var t in v.skip){if(this.dependencies[v.skip[t]]){delete this.dependencies[v.skip[t]]}if(this.optional[v.skip[t]]){delete this.optional[v.skip[t]]}}e.each(this.dependencies,function(){u.call(this)});e.each(this.optional,function(){u.call(this)})},createInstance:function(K,E){var J=this,A=function(L,u){var I=u.parentNode;if(I.lastchild==u){I.appendChild(L)}else{I.insertBefore(L,u.nextSibling)}},t=e(g),x=e(l),B=l.body,y=e(B),F=function(){},H=undefined,D=h,w=isNaN,G=NaN,v=function(u){this.cells=u||[]},C=v.prototype={clone:function(){var L=[];for(var I=0;I<this.cells.length;I++){var u=this.cells[I],M={value:u.value,formula:u.formula,td:u.td,dependencies:u.dependencies,needsUpdated:u.needsUpdated,calcCount:u.calcCount,sheet:u.sheet,calcLast:u.calcLast,html:u.html,state:u.state,jS:u.jS,calcDependenciesLast:u.calcDependenciesLast,style:u.style||u.td.attr("style")||"",cl:u.cl||u.td.attr("class")||""};L.push(M)}return new v(L)}},z={version:"4.x",i:0,I:E,sheetCount:0,spreadsheets:[],controls:{autoFiller:[],bar:{helper:[],corner:[],x:{controls:[],handleFreeze:[],menu:[],menuParent:[],parent:[],td:[],tds:function(){var I=e([]);for(var u in this.td[z.i]){I.pushStack(this.td[z.i][u])}return I}},y:{controls:[],handleFreeze:[],menu:[],parent:[],td:[],tds:function(){var I=e([]);for(var u in this.td[z.i]){I.pushStack(this.td[z.i][u])}return I}}},barMenuLeft:[],barMenuTop:[],barLeft:[],barTop:[],barTopParent:[],chart:[],tdMenu:[],cellsEdited:[],enclosure:[],enclosures:null,formula:null,fullScreen:null,header:null,inPlaceEdit:[],inputs:[],label:null,menuLeft:[],menuRight:[],menus:[],pane:[],panes:null,scrolls:null,sheetAdder:null,table:[],tables:null,tab:[],tabContainer:null,tabs:null,title:null,toggleHide:{x:[],y:[]},ui:null},obj:{autoFiller:function(){return z.controls.autoFiller[z.i]||e([])},barCorner:function(){return z.controls.bar.corner[z.i]||e([])},barHelper:function(){return z.controls.bar.helper[z.i]||(z.controls.bar.helper[z.i]=e([]))},barLeft:function(u){return(z.controls.bar.y.td[z.i]&&z.controls.bar.y.td[z.i][u]?z.controls.bar.y.td[z.i][u]:e([]))},barLeftControls:function(){return z.controls.bar.y.controls[z.i]||e([])},barLefts:function(){return z.controls.bar.y.tds()},barHandleFreezeLeft:function(){return z.controls.bar.y.handleFreeze[z.i]||e([])},barMenuLeft:function(){return z.controls.bar.y.menu[z.i]||e([])},barTop:function(u){return(z.controls.bar.x.td[z.i]&&z.controls.bar.x.td[z.i][u]?z.controls.bar.x.td[z.i][u]:e([]))},barTopControls:function(){return z.controls.bar.x.controls[z.i]||e([])},barTops:function(){return z.controls.bar.x.tds()},barTopParent:function(){return z.controls.bar.x.parent[z.i]||e([])},barHandleFreezeTop:function(){return z.controls.bar.x.handleFreeze[z.i]||e([])},barMenuParentTop:function(){return z.controls.bar.x.menuParent[z.i]||e([])},barMenuTop:function(){return z.controls.bar.x.menu[z.i]||e([])},tdActive:function(){return z.cellLast.td||e([])},tdMenu:function(){return z.controls.tdMenu[z.i]||e([])},cellsEdited:function(){return z.controls.cellsEdited[z.i]||e([])},chart:function(){return z.controls.chart[z.i]||e([])},enclosure:function(){return z.controls.enclosure[z.i]||e([])},enclosures:function(){return z.controls.enclosures||e([])},formula:function(){return z.controls.formula||e([])},fullScreen:function(){return z.controls.fullScreen||e([])},header:function(){return z.controls.header||e([])},highlighted:function(){return z.highlightedLast.obj||e([])},menuRight:function(){return z.controls.menuRight[z.i]||e([])},inPlaceEdit:function(){return z.controls.inPlaceEdit[z.i]||e([])},inputs:function(){return z.controls.inputs[z.i]||e([])},label:function(){return z.controls.label||e([])},menus:function(){return z.controls.menus[z.i]||e([])},menuLeft:function(){return z.controls.menuLeft[z.i]||e([])},pane:function(){return z.controls.pane[z.i]||{}},panes:function(){return z.controls.panes||e([])},parent:function(){return K.parent},scrolls:function(){return z.controls.scrolls||e([])},sheetAdder:function(){return z.controls.sheetAdder||e([])},table:function(){return z.controls.table[z.i]||e([])},tables:function(){return z.controls.tables||e([])},tab:function(){return z.controls.tab[z.i]||e([])},tabs:function(){return z.controls.tabs||e([])},tabContainer:function(){return z.controls.tabContainer||e([])},title:function(){return z.controls.title||e([])}},id:"jS_"+E+"_",cl:{autoFiller:"jSAutoFiller",autoFillerHandle:"jSAutoFillerHandle",autoFillerCover:"jSAutoFillerCover",barCorner:"jSBarCorner",barController:"jSBarController",barHelper:"jSBarHelper",barLeft:"jSBarLeft",barHandleFreezeLeft:"jSBarHandleFreezeLeft",barTop:"jSBarTop",barTopMenuButton:"jSBarTopMenuButton",barHandleFreezeTop:"jSBarHandleFreezeTop",barTopParent:"jSBarTopParent",chart:"jSChart",formula:"jSFormula",formulaParent:"jSFormulaParent",header:"jSHeader",fullScreen:"jSFullScreen",inPlaceEdit:"jSInPlaceEdit",menu:"jSMenu",menuFixed:"jSMenuFixed",parent:"jSParent",scroll:"jSScroll",sheetAdder:"jSSheetAdder",table:"jS",label:"jSLoc",pane:"jSEditPane",tab:"jSTab",tabContainer:"jSTabContainer",tdMenu:"jSTdMenu",title:"jSTitle",enclosure:"jSEnclosure",ui:"jSUI",uiAutoFiller:"cs-handle",uiBar:"ui-widget-header",uiBarHighlight:"ui-state-active",uiBarHandleFreezeLeft:"ui-state-default",uiBarHandleFreezeTop:"ui-state-default",uiBarMenuTop:"ui-state-default",uiTdActive:"ui-state-active",uiTdHighlighted:"cs-highlight",uiControl:"ui-widget-header ui-corner-top",uiControlTextBox:"ui-widget-content",uiFullScreen:"ui-widget-content ui-corner-all",uiInPlaceEdit:"cs-highlight",uiMenu:"cs-menu-background",uiMenuUl:"cs-menu-background",uiMenuLi:"cs-menu",uiPane:"ui-widget-content",uiParent:"ui-widget-content ui-corner-all",uiTable:"ui-widget-content",uiTab:"ui-widget-header",uiTabActive:"cs-highlight"},msg:{addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",cellFind:"What are you looking for in this spreadsheet?",cellNoFind:"No results found.",dragToFreezeCol:"Drag to freeze column",dragToFreezeRow:"Drag to freeze row",addSheet:"Add a spreadsheet",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",toggleHideRow:"No row selected.",toggleHideColumn:"No column selected.",loopDetected:"Loop Detected",newSheetTitle:"What would you like the sheet's title to be?",notFoundColumn:"Column not found",notFoundRow:"Row not found",notFoundSheet:"Sheet not found",setCellRef:"Enter the name you would like to reference the cell by.",sheetTitleDefault:"Spreadsheet {index}",maxRowsBrowserLimitation:"You've reached the maximum amount of rows this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxColsBrowserLimitation:"You've reached the maximum amount of columns this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxSizeBrowserLimitationOnOpen:"The spreadsheet you are loading is larger than the maximum size of cells this browser supports. Try using Chrome, Firefox, or Internet Explorer 9+. You can an proceed, but the spreadsheet may not work as intended."},kill:function(){if(!z){return false}e(l).unbind("keydown");this.obj.fullScreen().remove();(this.obj.inPlaceEdit().destroy||F)();K.parent.trigger("sheetKill").removeClass(z.cl.uiParent).html("");K.parent[0].jS=H;this.obj.menus().remove();var u=e.sheet.events.length;for(var I=0;I<u;I++){K.parent.unbind(e.sheet.events[I])}e.sheet.instance.splice(E,1);return true},trigger:function(u,I){I=I||[];return K.parent.triggerHandler(u,[z].concat(I))},spreadsheetsToArray:function(u){if(u||z.spreadsheets.length==0){z.cycleCellsAll(function(L,M,I){z.createCell(L,M,I)})}return z.spreadsheets},spreadsheetToArray:function(I,u){u=(u?u:z.i);if(!z.spreadsheets[u]){z.cycleCells(function(M,N,L){z.createCell(M,N,L)})}return z.spreadsheets[u]},createCell:function(P,S,U,X,W,aa){var L,Q,T,I,Z,V,M,N,u,R,O,ab,Y;if(!(L=z.spreadsheets[P])){L=z.spreadsheets[P]=[]}if(!(Q=L[S])){Q=L[S]=[]}if(!(Z=z.controls.tables[P])){return{}}if(!(N=Z.tBody)){return{}}if(!(u=N.children[S])){return{}}if(!(R=u.children[U])){return{}}O=e(R);T=Q[U]=R.jSCell={td:O,dependencies:[],formula:R.getAttribute("data-formula")||"",cellType:R.getAttribute("data-celltype")||null,value:R.textContent||R.innerText||"",calcCount:X||0,calcLast:W||-1,calcDependenciesLast:aa||-1,sheet:P,type:"cell",jS:z,state:[],needsUpdated:true,uneditable:R.getAttribute("data-uneditable")||false};if(T.formula&&T.formula.charAt(0)=="="){T.formula=T.formula.substring(1)}V=Z.colGroup;while(!(M=V.children[U])){M=l.createElement("col");M.setAttribute("style","width:"+z.s.newColumnWidth+"px;");V.appendChild(M)}if(!(I=M.jSCells)){I=M.jSCells=[]}I.unshift(T);if(!M.tds){M.tds=[]}M.tds.unshift(R);R.col=M;R.type="cell";R.barLeft=u.children[0];R.barTop=N.children[0].children[U];if(!u.jSCells){u.jSCells=[]}u.jSCells.unshift(T);if(!u.tds){u.tds=[]}u.tds.unshift(R);if(!Z.jSCells){Z.jSCells=[]}Z.jSCells.unshift(T);if(!Z.tds){Z.tds=[]}Z.tds.unshift(R);R.table=Z;if(!(Y=z.controls.bar.y.td[P])){Y=z.controls.bar.y.td[P]=[]}if(!Y[S]){Y[S]=e(u.children[0])}if(!(ab=z.controls.bar.x.td[P])){ab=z.controls.bar.x.td[P]=[]}if(!ab[U]){ab[U]=e(N.children[0].children[U])}return T},getCell:function(O,M,L){var I,N,u;L=(L||0);if(z.spreadsheets&&(I=z.spreadsheets[L])&&(N=I[O])&&(u=N[M])){return u}return null},nav:false,setNav:function(L){var u=e.sheet.instance;for(var I=0;I<u.length;I++){(u[I]||{}).nav=false}z.nav=L},controlFactory:{addRowMulti:function(L,N,I,u){function M(O){if(O){if(!w(O)){z.controlFactory.addCells(L,I,parseInt(O),"row",u);z.trigger("sheetAddRow",[L,I,O])}}}if(!N){K.prompt(z.msg.addRowMulti,M)}else{M(N)}},addColumnMulti:function(L,N,I,u){function M(O){if(O){if(!w(O)){z.controlFactory.addCells(L,I,parseInt(O),"col",u);z.trigger("sheetAddColumn",[L,I,O])}}}if(!N){K.prompt(z.msg.addColumnMulti,M)}else{M(N)}},addCells:function(T,R,Y,X,N){z.autoFillerHide();z.setDirty(true);z.setChanged(true);z.obj.barHelper().remove();var V=z.obj.table(),W=V[0],u=z.sheetSize(W),S=false,P=z.obj.tdActive(),L;Y=Y||1;X=X||"col";if(T==H){T=(X=="row"?u.rows:u.cols);S=true}switch(X){case"row":if(e.sheet.max){if(e.sheet.max>u.rows&&e.sheet.max<=u.rows+Y){Y=e.sheet.max-u.rows}else{if(e.sheet.max&&e.sheet.max<=u.rows+Y){if(!z.isBusy()){K.alert(z.msg.maxRowsBrowserLimitation)}return false}}}L={el:function(){var Z=z.rowTds(W,T);if(!Z||!Z[0]){return[]}return[Z[0].parentNode]},size:function(){if(!L.Size){var Z=L.el()[0];L.Size=Z.children.length-1}return L.Size},loc:function(){var Z=L.el();return z.getTdLocation(Z[0].children)},trs:[],newObj:function(){var Z=L.size(),ab=l.createElement("tr");ab.setAttribute("style","height: "+K.colMargin+"px;");for(var aa=0;aa<=Z;aa++){var ac=l.createElement("td");if(aa==0){ac.setAttribute("class",z.cl.barLeft+" "+z.cl.uiBar);ac.entity="left";ac.type="bar"}ab.appendChild(ac)}L.trs.push(ab);return ab},offset:{row:Y,col:0},start:function(){return{row:(R?T:T+Y)}},createCells:function(){for(var ab=0;ab<L.trs.length;ab++){var aa=(R?0:1)+T;z.spreadsheets[z.i].splice(ab+aa,0,[]);for(var Z=0;Z<L.trs[ab].children.length;Z++){if(Z==0){z.controls.bar.y.td[z.i].splice(ab+aa,0,e(L.trs[ab].children[Z]))}else{z.createCell(z.i,ab+aa,Z)}}}z.refreshRowLabels(T)}};break;case"col":if(e.sheet.max){if(e.sheet.max>u.cols&&e.sheet.max<=u.cols+Y){Y=e.sheet.max-u.cols}else{if(e.sheet.max&&e.sheet.max<=u.cols+Y){if(!z.isBusy()){K.alert(z.msg.maxColsBrowserLimitation)}return false}}}L={el:function(){var aa=z.rowTds(W,1)[T],ad=z.rowTds(W),ae=ad[ad.length-1],ac=z.getTdLocation(ae),ab=[];for(var Z=0;Z<=ac.row;Z++){ab.push(W.tBody.children[Z].children[T])}return ab},col:function(){return z.col(W,T)},cols:[],newCol:function(){var Z=l.createElement("col");Z.setAttribute("style","width:"+z.s.newColumnWidth+"px;");L.cols.push(Z);return Z},loc:function(Z){Z=(Z?Z:L.el());return z.getTdLocation(Z[0])},tds:[],newObj:function(){var Z=l.createElement("td");L.tds.push(Z);return Z},offset:{row:0,col:Y},start:function(){return{col:(R?T:T+Y)}},createCells:function(){var ab=z.rows(W);for(var ad=0;ad<ab.length;ad++){var aa=(R?0:1)+T,af=aa+Y,Z=0;for(aa;aa<af;aa++){var ae=W.tBody.children[ad].children[aa],ac=e(ae);if(ad==0){z.controls.bar.x.td[z.i].splice(aa,0,ac);ae.innerText=i.columnLabelString(aa);ae.className=z.cl.barTop+" "+z.cl.uiBar;ae.type="bar";ae.entity="top";L.cols[Z].setAttribute("style","width:"+z.s.newColumnWidth+"px;");L.cols[Z].bar=ae;Z++}else{z.spreadsheets[z.i][ad].splice(aa,0,{});z.createCell(z.i,ad,aa)}}}z.refreshColumnLabels(T)}};break}var I=L.el(),U=L.loc(I),M,Q=I.length-1,O;if(R){do{O=Y-1;do{I[Q].parentNode.insertBefore(L.newObj(),I[Q])}while(O--)}while(Q--);if(L.newCol){M=L.col();O=Y-1;do{M.parentNode.insertBefore(L.newCol(),M)}while(O--)}}else{do{O=Y-1;do{A(L.newObj(),I[Q])}while(O--)}while(Q--);if(L.newCol){M=L.col();O=Y-1;do{A(L.newCol(),M)}while(O--)}}L.createCells();if(!N&&S!=true){z.offsetFormulas(U,L.offset,R)}z.obj.pane().resizeScroll(true);if(P&&P[0]&&P[0].cellIndex&&P[0].parentNode){z.colLast=P[0].cellIndex;z.rowLast=P[0].parentNode.rowIndex}return true},addRow:function(M,L){var N=h.min(z.highlightedLast.end.row,z.highlightedLast.start.row);var u=h.max(z.highlightedLast.end.row,z.highlightedLast.start.row);var I=u-N+1;z.controlFactory.addCells(L?N:u,L,I,"row");z.trigger("sheetAddRow",[L?N:u,L,I])},addColumn:function(M,L){var N=h.min(z.highlightedLast.end.col,z.highlightedLast.start.col);var u=h.max(z.highlightedLast.end.col,z.highlightedLast.start.col);var I=u-N+1;z.controlFactory.addCells(L?N:u,L,I,"col");z.trigger("sheetAddColumn",[L?N:u,L,I])},barLeft:function(I){var L=I.tBody.children,u=L.length-1;if(u>-1){do{L[u].insertBefore(l.createElement("td"),L[u].children[0])}while(u-->1)}},barTop:function(R){var u=R.colGroup,Q=u.children,N,I=R.tBody.children[0],P=l.createElement("col"),M=l.createElement("td"),O=l.createElement("tr");while(Q.length>I.children.length){u.removeChild(Q[Q.length-1])}P.width=K.colMargin+"px";P.style.width=P.width;u.insertBefore(P,u.children[0]);O.appendChild(M);O.className=z.cl.barTopParent;R.tBody.insertBefore(O,R.tBody.children[0]);R.barTopParent=O;R.corner=M;z.controls.barTopParent[z.i]=e(O);N=I.children.length-1;do{var L=l.createElement("td");if(!Q[N]){Q[N]=l.createElement("col");u.insertBefore(Q[N],P.nextSibling)}Q[N].bar=L;L.col=Q[N];O.insertBefore(L,M.nextSibling)}while(N-->0);R.barTop=z.controls.barTopParent[z.i].children();return O},barHandleFreeze:{top:function(L){if(z.isBusy()){return false}var u=z.obj.pane().actionUI,T=u.frozenAt,Q=u.scrolledArea;if(!(Q.end.col<=T.col+1)){return false}z.obj.barHelper().remove();var P=z.obj.barTop(T.col+1),R=P.position(),S,M=e(L).offset(),O=l.createElement("div"),I=L.freezeHandleTop=e(O).appendTo(L).addClass(z.cl.uiBarHandleFreezeTop+" "+z.cl.barHelper+" "+z.cl.barHandleFreezeTop).height(P.height()).css("left",(R.left-O.clientWidth)+"px").attr("title",z.msg.dragToFreezeCol),N=L.table.barTop;z.controls.bar.helper[z.i]=z.obj.barHelper().add(O);z.controls.bar.x.handleFreeze[z.i]=I;z.draggable(I,{axis:"x",start:function(){z.setBusy(true);S=e(l.createElement("div")).appendTo(L).css("position","absolute").addClass("ui-state-highlight "+z.cl.barHelper).height(L.table.corner.clientHeight).fadeTo(0,0.33)},drag:function(){var U=z.nearest(I,N).prev();if(U.length&&U.position){S.width(U.position().left+U.width())}},stop:function(W,U){S.remove();z.setBusy(false);z.setDirty(true);var V=z.nearest(I,N);z.obj.barHelper().remove();Q.end.col=u.frozenAt.col=z.getTdLocation(V).col-1;z.autoFillerHide();u.scrollStart("x",z.sheetSize(L.table))},containment:[M.left,M.top,D.min(M.left+L.table.clientWidth,M.left+L.clientWidth-g.scrollBarSize.width),M.top]});return true},left:function(L){if(z.isBusy()){return false}var L=z.obj.pane(),u=L.actionUI,T=u.frozenAt,Q=u.scrolledArea;if(!(Q.end.row<=(T.row+1))){return false}z.obj.barHelper().remove();var P=e(L.table.tBody.children[T.row+1].children[0]),R=P.position(),S,M=e(L).offset(),O=l.createElement("div"),I=L.freezeHandleLeft=e(O).appendTo(L).addClass(z.cl.uiBarHandleFreezeLeft+" "+z.cl.barHelper+" "+z.cl.barHandleFreezeLeft).width(P.width()).css("top",(R.top-O.clientHeight)+"px").attr("title",z.msg.dragToFreezeRow),N=e(L.table.tBody.children);z.controls.bar.helper[z.i]=z.obj.barHelper().add(O);z.controls.bar.y.handleFreeze[z.i]=I;z.draggable(I,{axis:"y",start:function(){z.setBusy(true);S=e(l.createElement("div")).appendTo(L).css("position","absolute").addClass("ui-state-highlight "+z.cl.barHelper).width(O.clientWidth).fadeTo(0,0.33)},drag:function(){var U=z.nearest(I,N).prev();if(U.length&&U.position){S.height(U.position().top+U.height())}},stop:function(W,U){S.remove();z.setBusy(false);z.setDirty(true);var V=z.nearest(I,N);z.obj.barHelper().remove();Q.end.row=u.frozenAt.row=D.max(z.getTdLocation(V.children(0)).row-1,0);z.autoFillerHide();L.actionUI.scrollStart("y",z.sheetSize(L.table))},containment:[M.left,M.top,M.left,D.min(M.top+L.table.clientHeight,M.top+L.clientHeight-g.scrollBarSize.height)]});return true},corner:function(){}},menu:function(L,u){var N,I=e([]);switch(L){case"top":N=e(l.createElement("div")).addClass(z.cl.uiMenu+" "+z.cl.tdMenu);z.controls.bar.x.menu[z.i]=N;break;case"left":N=e(l.createElement("div")).addClass(z.cl.uiMenu+" "+z.cl.tdMenu);z.controls.bar.y.menu[z.i]=N;break;case"cell":N=e(l.createElement("div")).addClass(z.cl.uiMenu+" "+z.cl.tdMenu);z.controls.tdMenu[z.i]=N;break}z.controls.menus[z.i]=z.obj.menus().add(N);N.mouseleave(function(){N.hide()}).bind("contextmenu",function(){return false}).appendTo(y).hide().disableSelectionSpecial();for(var M in u){if(u[M]){if(e.isFunction(u[M])){I.pushStack(e(l.createElement("div")).text(M).data("msg",M).click(function(){u[e(this).data("msg")].call(this,z);N.hide();return false}).appendTo(N).hover(function(){I.removeClass("ui-state-highlight");e(this).addClass("ui-state-highlight")},function(){e(this).removeClass("ui-state-highlight")}))}else{if(u[M]=="line"){e(l.createElement("hr")).appendTo(N)}}}}return N},barMenu:{top:function(L,u,I){if(z.isBusy()){return false}var N=z.obj.barMenuTop().hide();if(!N.length){N=z.controlFactory.menu("top",K.contextmenuTop)}z.obj.menus().hide();if(!I){N.css("left",(L.pageX-5)+"px").css("top",(L.pageY-5)+"px").show();return N}var M=z.obj.barMenuParentTop().hide();if(!M.length){M=e(l.createElement("div")).addClass(z.cl.uiBarMenuTop+" "+z.cl.barHelper+" "+z.cl.barTopMenuButton).append(e(l.createElement("span")).addClass("ui-icon ui-icon-triangle-1-s")).mousedown(function(O){M.parent().mousedown().mouseup();var P=M.offset();N.css("left",(O.pageX-5)+"px").css("top",(O.pageY-5)+"px").show()}).blur(function(){if(N){N.hide()}}).bind("destroy",function(){M.remove();z.controls.bar.x.menuParent[z.i]=null});z.controls.bar.x.menuParent[z.i]=M}M.prependTo(I).show()},left:function(I,u){if(z.isBusy()){return false}z.obj.barMenuLeft().hide();if(u){z.obj.barHandleFreezeLeft().remove()}var L;L=z.obj.barMenuLeft();if(!L.length){L=z.controlFactory.menu("left",K.contextmenuLeft)}z.obj.menus().hide();L.css("left",(I.pageX-5)+"px").css("top",(I.pageY-5)+"px").show();return true},corner:function(){}},tdMenu:function(u){if(z.isBusy()){return false}z.obj.tdMenu().hide();var I=z.obj.tdMenu();if(!I.length){I=z.controlFactory.menu("cell",K.contextmenuCell)}z.obj.menus().hide();I.css("left",(u.pageX-5)+"px").css("top",(u.pageY-5)+"px").show();return true},header:function(){z.obj.header().remove();z.obj.sheetAdder().remove();z.obj.tabContainer().remove();var R=l.createElement("div"),L=l.createElement("table"),O=l.createElement("tr"),U,M,V=l.createElement("td"),W,N,I,S,u;R.appendChild(L);L.appendChild(O);R.className=z.cl.header+" "+z.cl.uiControl;z.controls.header=e(R);if(K.title){if(e.isFunction(K.title)){K.title=z.title(z,E)}V.className=z.cl.title;z.controls.title=e(V).html(K.title)}else{e(V).hide()}O.appendChild(V);function T(Y){if(e.isFunction(Y)){Y=e(Y.call(z))}else{Y=e(Y)}if(!a){a=Y}if(Y.is("ul")){Y.find("ul").hide().addClass(z.cl.uiMenuUl);Y.find("li").addClass(z.cl.uiMenuLi).hover(function(){e(this).find("ul:first").hide().show()},function(){e(this).find("ul:first").hide()})}return Y}if(z.isSheetEditable()){if(K.menuLeft){N=l.createElement("td");N.className=z.cl.menu+" "+z.cl.menuFixed;O.insertBefore(N,V);z.controls.menuLeft[z.i]=e(N).append(T(K.menuLeft));z.controls.menuLeft[z.i].find("img").load(function(){z.sheetSyncSize()})}if(K.menuRight){I=l.createElement("td");I.className=z.cl.menu+" "+z.cl.menuFixed;O.insertBefore(I,V);z.controls.menuRight[z.i]=e(I).append(T(K.menuRight));z.controls.menuRight[z.i].find("img").load(function(){z.sheetSyncSize()})}W=l.createElement("td");W.className=z.cl.label;z.controls.label=e(W);S=l.createElement("textarea");S.className=z.cl.formula;S.onkeydown=z.evt.formula.keydown;S.onkeyup=function(){z.obj.inPlaceEdit().value=this.value};S.onchange=function(){z.obj.inPlaceEdit().value=this.value};S.onpaste=z.evt.pasteOverCells;S.onfocus=function(){z.setNav(false)};S.onfocusout=function(){z.setNav(true)};S.onblur=function(){z.setNav(true)};z.controls.formula=e(S);var Q=l.createElement("span");Q.appendChild(S);U=l.createElement("table");M=l.createElement("tr");U.appendChild(M);R.appendChild(U);u=l.createElement("td");u.className=z.cl.formulaParent;u.appendChild(Q);M.appendChild(W);M.appendChild(u);z.resizableSheet(e(Q),{minHeight:z.controls.formula.height(),maxHeight:78,handles:"s",resize:function(Z,Y){z.controls.formula.height(Y.size.height)},stop:function(){z.sheetSyncSize()}});var X=e.sheet.instance;for(var P=0;P<X.length;P++){(X||{}).nav=false}z.setNav(true);e(l).keydown(z.evt.document.keydown)}return R},ui:function(){var u=l.createElement("div");u.setAttribute("class",z.cl.ui);z.obj.ui=u;return u},sheetAdder:function(){var u=l.createElement("span");if(z.isSheetEditable()){u.setAttribute("class",z.cl.sheetAdder+" "+z.cl.tab+" "+z.cl.uiTab+" ui-corner-bottom");u.setAttribute("title",z.msg.addSheet);u.innerHTML="&nbsp;+&nbsp;";u.onmousedown=function(){z.addSheet();return false};u.i=-1}return z.controls.sheetAdder=e(u)},tabContainer:function(){var u=l.createElement("span"),I;u.setAttribute("class",z.cl.tabContainer);u.onmousedown=function(M){M=M||g.event;var L=(M.target||M.srcElement).i;if(L>=0){z.trigger("sheetSwitch",[L])}return false};u.ondblclick=function(M){M=M||g.event;var L=(M.target||M.srcElement).i;if(L>=0){z.trigger("sheetRename",[L])}return false};if(z.isSheetEditable()&&e.fn.sortable){return z.controls.tabContainer=e(u).sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:true,forcePlaceholderSize:true,opacity:0.6,start:function(M,L){I=L.item.index();z.trigger("sheetTabSortStart",[M,L])},update:function(M,L){z.trigger("sheetTabSortUpdate",[M,L,I])}})}return z.controls.tabContainer=e(u)},sheetUI:function(S,T,N){z.i=N;z.tuneTableForSheetUse(T);z.readOnly[N]=(T.className||"").match(/\breadonly\b/i)!=null;var O=z.controlFactory.enclosure(T),L=O.pane,I=e(L),P=function(X){X=X||g.event;if(z.isBusy()){return false}if(z.isBar(X.target)){var V=X.target.entity,W=z.getBarIndex[V](X.target);if(W<0){return false}if(z.evt.barInteraction.first==z.evt.barInteraction.last){z.controlFactory.barMenu[V](X,W)}}else{z.controlFactory.tdMenu(X)}return false};S.appendChild(O);z.controlFactory.barTop(T);z.controlFactory.barLeft(T);L.appendChild(T);if(z.isSheetEditable()){z.controlFactory.autoFiller(L)}if(z.isSheetEditable()){var Q=z.obj.formula(),U="";I.mousedown(function(V){z.setNav(true);if(z.isBusy()){return false}if(z.isCell(V.target)){if(V.button==2){P.call(this,V);z.evt.cellOnMouseDown(V);return true}z.evt.cellOnMouseDown(V);return false}if(z.isBar(V.target)){if(V.button==2){P.call(this,V)}U=V.target.entity;z.evt.barInteraction.select(V.target);return false}return true});L.onmouseup=function(){U=""};L.onmouseover=function(Z){Z=Z||g.event;var Y=Z.target||Z.srcElement;if(z.isBusy()){return false}if(!z.isBar(Y)){return false}var X=e(Y),V=Y.entity,W=z.getBarIndex[V](Y);if(W<0){return false}if(z.evt.barInteraction.selecting&&V==U){z.evt.barInteraction.last=W;z.cellSetActiveBar(V,z.evt.barInteraction.first,z.evt.barInteraction.last)}else{z.resizeBar[V](X,W,L,T);if(z.isSheetEditable()){z.controlFactory.barHandleFreeze[V](L);if(V=="top"){z.controlFactory.barMenu[V](Z,W,X)}}}return true};L.ondblclick=z.evt.cellOnDblClick;I.bind("contextmenu",P).disableSelectionSpecial().bind("cellEdit",z.evt.cellEdit)}z.themeRoller.start(T);z.createSpreadsheet(T,N);z.checkMinSize(T);z.controlFactory.tab();var M=z.s,u=M.hiddenRows,R=M.hiddenColumns;if(!u.length||!R.length){u=T.attributes["data-hiddenrows"]||{value:""};R=T.attributes["data-hiddencolumns"]||{value:""};if(u.value.length>0){u=d.toNumbers(u.value.split(","))}if(R.value.length>0){R=d.toNumbers(R.value.split(","))}}O.actionUI.hide(u,R,z.rows(T),z.cols(T));z.setChanged(true)},enclosure:function(L){var O=l.createElement("div"),N=l.createElement("div"),I=e(N),u=new k.ActionUI(N,O,L,z.cl.scroll,z.s.frozenAt[z.i],e.sheet.max),M=u.scrollUI;L.size=function(){return z.sheetSize(L)};M.onscroll=function(){if(z.manScroll==true){z.manScroll=false;return}if(!z.isBusy()){var Q=u.scrollTo({axis:"x",pixel:this.scrollLeft}),P=u.scrollTo({axis:"y",pixel:this.scrollTop});if(Q||P){if(Q){setTimeout(function(){z.calcVisibleCol(u)},0)}if(P){setTimeout(function(){z.calcVisibleRow(u)},0)}z.obj.barHelper().remove();z.autoFillerGoToTd();if(O.inPlaceEdit){O.inPlaceEdit.goToTd()}}}};M.onmousedown=function(){z.obj.barHelper().remove()};N.actionUI=O.actionUI=u;N.scrollUI=O.scrollUI=M;N.appendChild(N.scrollUI);O.setAttribute("class",z.cl.pane+" "+z.cl.uiPane);N.appendChild(O);N.setAttribute("class",z.cl.enclosure);N.pane=O;N.table=L;O.table=L;O.enclosure=N;O.$enclosure=I;L.pane=O;L.enclosure=N;L.$enclosure=I;z.controls.pane[z.i]=O;z.controls.panes=z.obj.panes().add(O);z.controls.enclosure[z.i]=I;z.controls.enclosures=z.obj.enclosures().add(N);return N},tab:function(){var u=l.createElement("span"),I=z.controls.tab[z.i]=e(u).appendTo(z.obj.tabContainer());u.setAttribute("class",z.cl.tab);z.sheetTab(true,function(L){u.innerHTML=L});u.i=z.i;u.setAttribute("class",z.cl.uiTab+" ui-corner-bottom");z.controls.tabs=z.obj.tabs().add(I);return u},inPlaceEdit:function(P,I){P=P||z.obj.tdActive();if(!P.length){P=e(z.rowTds(null,1)[1]);z.cellEdit(P)}if(!P.length){return}(z.obj.inPlaceEdit().destroy||F)();var O=z.obj.formula(),L=O.val(),u,N,M=z.obj.pane();if(!P[0].isHighlighted){return}u=l.createElement("textarea");N=e(u);M.inPlaceEdit=u;u.i=z.i;u.className=z.cl.inPlaceEdit+" "+z.cl.uiInPlaceEdit;u.td=P[0];u.goToTd=function(){this.offset=P.position();if(!this.offset.left&&!this.offset.right){e(u).hide()}else{this.setAttribute("style","resize: none;left:"+(this.offset.left-1)+"px;top:"+(this.offset.top-1)+"px;width:"+this.td.clientWidth+"px;height:"+this.td.clientHeight+"px;min-width:"+this.td.clientWidth+"px;min-height:"+this.td.clientHeight+"px;")}};u.goToTd();u.onkeydown=z.evt.inPlaceEdit.keydown;u.onchange=u.onkeyup=function(){O[0].value=u.value};u.onfocus=function(){z.setNav(false)};u.onblur=u.onfocusout=function(){z.setNav(true)};u.onpaste=z.evt.pasteOverCells;u.destroy=function(){M.inPlaceEdit=null;z.cellLast.isEdit=(u.value!=L);u.parentNode.removeChild(u);z.controls.inPlaceEdit[u.i]=false};M.appendChild(u);u.onfocus();z.controls.inPlaceEdit[z.i]=u;N.focus().val("").val(O[0].value);if(I){N.select()}if(e.fn.elastic){e(u).elastic()}},autoFiller:function(M){if(!K.autoFiller){return false}var I=l.createElement("div"),u=l.createElement("div"),L=l.createElement("div");I.i=z.i;I.className=z.cl.autoFiller+" "+z.cl.uiAutoFiller;u.className=z.cl.autoFillerHandle;L.className=z.cl.autoFillerCover;I.onmousedown=function(){var O=z.obj.tdActive();if(O){var N=z.getTdLocation(O);z.cellSetActive(O,N,true,z.autoFillerNotGroup,function(){var Q=z.highlighted(),P=z.getTdLocation(Q.last());z.fillUpOrDown(P.row<N.row||P.col<N.col);z.autoFillerGoToTd(O);z.autoFillerNotGroup=false})}return false};M.autoFiller=z.controls.autoFiller[z.i]=e(I);M.appendChild(I);return true}},autoFillerNotGroup:true,updateCellsAfterPasteToFormula:function(T){var S=0,R=z.obj.formula(),V=new b();T=T||R.val();var Q={row:z.cellLast.row,col:z.cellLast.col},I=R.val(),M=I;if(z.copiedClasses&&I){var P=z.highlighted();var L=null;for(O=0;O<P.length;O++){L=P[O];for(N=0;N<z.copiedClasses.length;N++){if(z.copiedClasses[N]&&!L.className.match(z.copiedClasses[N])){e(L).addClass(z.copiedClasses[N])}}e(L).css("font-size",((z.copiedSize||10))+"px")}z.cellTypeToggle(z.copiedType)}if(Q.row==0&&Q.col==0){return false}var W=tsv.parse(I);if(!e.isArray(W)){R.val(W);z.fillUpOrDown(false,W);return true}for(var O=0;O<W.length;O++){z.cellLast.isEdit=true;var u=W[O];for(var N=0;N<u.length;N++){S++;var L=z.getTd(z.i,O+Q.row,N+Q.col);L.row=Q.row;L.col=Q.col;if(L.length){if(!z.spreadsheets[z.i]||!z.spreadsheets[z.i][O+Q.row]||!z.spreadsheets[z.i][O+Q.row][N+Q.col]){continue}var U=z.spreadsheets[z.i][O+Q.row][N+Q.col];if(U){K.parent.one("sheetPreCalculation",function(){if((u[N]+"").charAt(0)=="="){U.formula=u[N].substring(1);U.value="";L.data("formula",u[N])}else{U.formula="";U.value=u[N];L.removeData("formula")}});z.calcDependencies.call(U);if(O==0&&N==0){M=u[N]}}}}}if(I!=M){R.val(M)}z.fillUpOrDown(false,M);z.evt.cellEditDone(true);return true},evt:{inPlaceEdit:{enter:function(u){if(u.shiftKey){return true}return z.evt.cellSetActiveFromKeyCode(u,true)},tab:function(u){if(u.shiftKey){return true}return z.evt.cellSetActiveFromKeyCode(u,true)},keydown:function(u){u=u||g.event;z.trigger("sheetFormulaKeydown",[true]);switch(u.keyCode){case p.ENTER:return z.evt.inPlaceEdit.enter(u);break;case p.TAB:return z.evt.inPlaceEdit.tab(u);break;case p.ESCAPE:z.evt.cellEditAbandon();return false;break}}},formula:{keydown:function(u){u=u||g.event;if(z.readOnly[z.i]){return false}if(z.cellLast.row<0||z.cellLast.col<0){return false}z.trigger("sheetFormulaKeydown",[false]);switch(u.keyCode){case p.C:if(u.ctrlKey){return z.evt.document.copy(u)}case p.X:if(u.ctrlKey){return z.evt.document.cut(u)}case p.Y:if(u.ctrlKey&&!z.cellLast.isEdit){z.lastRedo=new b();z.evt.document.redo(u);return false}break;case p.Z:if(u.ctrlKey&&!z.cellLast.isEdit){z.lastUndo=new b();z.evt.document.undo(u);return false}break;case p.F:if(u.ctrlKey){u.preventDefault();return find()}break;case p.N:if(u.ctrlKey){u.preventDefault();return newFile()}break;case p.O:if(u.ctrlKey){u.preventDefault();return load()}break;case p.S:if(u.ctrlKey){u.preventDefault();return save()}break;case p.ESCAPE:z.evt.cellEditAbandon();return true;break;case p.ENTER:z.evt.cellSetActiveFromKeyCode(u,true);return false;break}z.cellLast.isEdit=true},If:function(I,u){if(I){z.obj.tdActive().dblclick();return true}return false}},document:{enter:function(u){if(!z.cellLast.isEdit&&!u.ctrlKey){z.obj.tdActive().dblclick()}return false},tab:function(u){z.evt.cellSetActiveFromKeyCode(u)},findCell:function(u){if(u.ctrlKey){z.cellFind();return false}return true},redo:function(u){z.undo.manager.redo();return false},undo:function(u){z.undo.manager.undo();return false},copy:function(O,L){var N=z.highlighted(true),P=z.obj.formula(),M=P.val(),I=z.toTsv(N,L),u=N[0].cellType;N=z.highlighted();z.copiedClasses=N[0].className.split(/\s+/);z.copiedType=u;z.copiedSize=(e(N[0]).css("font-size")+"").replace("px","")*1;P.val(I).focus().select();x.one("keyup",function(){if(L){P.val("")}else{P.val(M)}});return true},cut:function(u){return this.copy(u,true)},pageUpDown:function(u){var M=z.sheetSize(),Q=z.obj.pane(),L=Q.clientHeight,N=0,O=0,P,I;if(u){for(I=z.cellLast.row;I>0&&N<L;I--){P=z.getTd(z.i,I,1);if(!P.data("hidden")&&P.is(":hidden")){P.show()}N+=P.parent().height()}}else{for(I=z.cellLast.row;I<M.rows&&N<L;I++){P=z.getTd(z.i,I,1);N+=P.parent().height()}}z.cellEdit(P);return false},keydown:function(I){I=I||g.event;if(z.readOnly[z.i]){return false}if(z.cellLast.row<0||z.cellLast.col<0){return false}var L=z.cellLast.td;if(z.nav){switch(I.keyCode){case p.DELETE:z.toTsv(null,true);z.obj.formula().val("");break;case p.TAB:z.evt.document.tab(I);break;case p.ENTER:z.evt.cellSetActiveFromKeyCode(I);break;case p.LEFT:case p.UP:case p.RIGHT:case p.DOWN:(I.shiftKey?z.evt.cellSetHighlightFromKeyCode(I):z.evt.cellSetActiveFromKeyCode(I));break;case p.PAGE_UP:z.evt.document.pageUpDown(true);break;case p.PAGE_DOWN:z.evt.document.pageUpDown();break;case p.HOME:case p.END:z.evt.cellSetActiveFromKeyCode(I);break;case p.F:if(I.ctrlKey){I.preventDefault();find()}else{L.trigger("cellEdit");return true}break;case p.N:if(I.ctrlKey){I.preventDefault();newFile()}else{L.trigger("cellEdit");return true}break;case p.O:if(I.ctrlKey){I.preventDefault();load()}else{L.trigger("cellEdit");return true}break;case p.S:if(I.ctrlKey){I.preventDefault();save()}else{L.trigger("cellEdit");return true}break;case p.V:if(I.ctrlKey){return z.evt.formula.If(!z.evt.pasteOverCells(I),I)}else{L.trigger("cellEdit");return true}break;case p.Y:if(I.ctrlKey&&!z.cellLast.isEdit){var u=new b();if(z.lastRedo&&u-z.lastRedo<100){return false}else{z.lastRedo=u;z.evt.document.redo(I);return false}}else{L.trigger("cellEdit");return true}break;case p.Z:if(I.ctrlKey&&!z.cellLast.isEdit){var u=new b();if(z.lastUndo&&u-z.lastUndo<100){return false}else{z.lastUndo=u;z.evt.document.undo(I);return false}}else{L.trigger("cellEdit");return true}break;case p.ESCAPE:z.evt.cellEditAbandon();break;case p.CAPS_LOCK:case p.SHIFT:case p.ALT:break;case p.CONTROL:z.obj.formula().focus().select();return true;break;default:L.trigger("cellEdit");return true;break}return false}}},pasteOverCells:function(I){I=I||g.event;if(I.ctrlKey||I.type=="paste"){var u=function(){z.updateCellsAfterPasteToFormula()};var L=x.one("keyup",function(){u();u=function(){};L.mouseup()}).one("mouseup",function(){u();u=function(){};L.keyup()});z.setDirty(true);z.setChanged(true);return true}return false},cellEditDone:function(L){(z.obj.inPlaceEdit().destroy||F)();if(z.cellLast.isEdit||L){var N=z.obj.formula(),M=z.obj.tdActive();if(z.isFormulaEditable(M)){if(M&&z.cellLast.row>0&&z.cellLast.col>0){var I=N.val(),u=M[0].jSCell;if(!u.edited){u.edited=true;z.controls.cellsEdited[z.i]=z.obj.cellsEdited().add(u)}K.parent.one("sheetPreCalculation",function(){if(I.charAt(0)=="="&&z.formulaParser){M.data("formula",I);u.value=I;u.formula=I}else{M.removeData("formula");u.value=I;u.formula=""}});z.calcDependencies.call(u);z.cellLast.isEdit=false;z.trigger("sheetCellEdited",[u])}}}},cellEditAbandon:function(u){(z.obj.inPlaceEdit().destroy||F)();z.themeRoller.bar.clearActive();z.themeRoller.cell.clearHighlighted(null,true);if(!u){z.calc()}z.cellLast.td=e([]);z.cellLast.row=0;z.cellLast.col=0;z.rowLast=0;z.colLast=0;z.highlightedLast.start={row:0,col:0};z.highlightedLast.end={row:0,col:0};z.labelUpdate("",true);z.obj.formula().val("").blur();z.autoFillerHide();return false},cellSetHighlightFromKeyCode:function(M){var L=z.highlightedLastOrdered(),I=z.sheetSize(),P=z.obj.tdActive(),N=z.getTdLocation(P),O=L.start,u=L.end;switch(M.keyCode){case p.UP:if(O.row<N.row){O.row--;O.row=D.max(O.row,1);break}u.row--;u.row=D.max(u.row,1);break;case p.DOWN:if(O.row===O.end){O.row++;O.row=D.min(O.row,I.rows);break}if(O.row<N.row){O.row++;O.row=D.max(O.row,1);break}u.row++;u.row=D.min(u.row,I.rows);break;case p.LEFT:if(O.col<N.col){O.col--;O.col=D.max(O.col,1);break}u.col--;u.col=D.max(u.col,1);break;case p.RIGHT:if(O.col<N.col){O.col++;O.col=D.min(O.col,I.cols);break}u.col++;u.col=D.min(u.col,I.cols);break}z.highlightedLast.start=O;z.highlightedLast.end=u;z.cycleCellArea(function(Q){z.themeRoller.cell.setHighlighted(Q.td)},O,u);return false},cellSetActiveFromKeyCode:function(N,u){var O={row:z.cellLast.row,col:z.cellLast.col},M=false,L,I=false;switch(N.keyCode){case p.UP:O.row--;break;case p.DOWN:O.row++;break;case p.LEFT:O.col--;break;case p.RIGHT:O.col++;break;case p.ENTER:O=z.evt.incrementAndStayInGrid(z.highlightedLastOrdered(),O,"row","col",N.shiftKey);M=true;L=z.highlighted();if(L.length>1){I=true}else{if(!u){O.row+=(N.shiftKey?-1:1)}if(K.autoAddCells&&O.row>z.sheetSize().rows){z.controlFactory.addRow()}}break;case p.TAB:O=z.evt.incrementAndStayInGrid(z.highlightedLastOrdered(),O,"col","row",N.shiftKey);M=true;L=z.highlighted();if(L.length>1){I=true}else{if(!u){O.col+=(N.shiftKey?-1:1)}if(K.autoAddCells&&O.col>z.sheetSize().cols){z.controlFactory.addColumn()}}break;case p.HOME:O.col=1;break;case p.END:O.col=z.obj.tdActive().parent().children("td").length-1;break}O.col=O.col||1;O.row=O.row||1;if(!z.cellLast.isEdit||M){var P=z.getTd(z.i,O.row,O.col);if(P){z.cellEdit(P,null,I);return false}}return true},incrementAndStayInGrid:function(M,N,I,u,L){if(L){N[I]--;if(N[I]<M.start[I]){N[I]=M.end[I];N[u]--}if(N[u]<M.start[u]){N[u]=M.end[u]}}else{N[I]++;if(N[I]>M.end[I]){N[I]=M.start[I];N[u]++}if(N[u]>M.end[u]){N[u]=M.start[u]}}return N},cellOnMouseDown:function(u){z.obj.formula().blur();if(u.shiftKey){z.getTdRange(u,z.obj.formula().val())}else{z.cellEdit(e(u.target),true)}},cellOnDblClick:function(u){if(z.isBusy()){return false}z.controlFactory.inPlaceEdit();return true},cellEdit:function(u){if(z.isBusy()){return false}z.controlFactory.inPlaceEdit(null,true);return true},barInteraction:{first:0,last:0,selecting:false,select:function(L){if(!L){return}if(!L.type=="bar"){return}var u=L.entity,I=z.getBarIndex[u](L);if(I<0){return false}z[u+"Last"]=I;z.evt.barInteraction.last=z.evt.barInteraction.first=I;z.cellSetActiveBar(u,z.evt.barInteraction.first,z.evt.barInteraction.last);z.evt.barInteraction.first=z.evt.barInteraction.last=z[u+"Last"]=I;z.evt.barInteraction.selecting=true;x.one("mouseup",function(){z.evt.barInteraction.selecting=false});return false}}},refreshColumnLabels:function(L){L=L||0;z.obj.barMenuParentTop().trigger("destroy");var I=z.controls.bar.x.td[z.i];if(!I){return}for(var u=L;u<I.length;u++){if(u){I[u].text(i.columnLabelString(I[u][0].cellIndex))}}},refreshRowLabels:function(M,u){M=M||0;var L=z.controls.bar.y.td[z.i];if(!L){return}u=u||L.length;for(var I=M;I<u;I++){if(I){e(L[I]).text(L[I][0].parentNode.rowIndex)}}},isCell:function(u){if(u&&u.tagName&&u.tagName=="TD"&&u.type&&u.type=="cell"){return true}return false},isBar:function(u){if(u&&u.tagName&&u.tagName=="TD"&&u.type&&u.type=="bar"){return true}return false},readOnly:[],isSheetEditable:function(u){u=u||z.i;return(K.editable==true&&!z.readOnly[u])},isFormulaEditable:function(u){if(K.lockFormulas){if(u.data("formula")!==H){return false}}return true},toggleFullScreen:function(){if(!z){return}z.evt.cellEditDone();var L=z.obj.fullScreen(),O=z.obj.pane();if(L.is(":visible")){t.unbind("jSResize");y.removeClass("bodyNoScroll");K.parent=L[0].origParent;K.parent.prepend(L.children());L.remove();z.sheetSyncSize();O.resizeScroll();z.trigger("sheetFullScreen",[false])}else{y.addClass("bodyNoScroll");var M=e(K.parent),L=l.createElement("div"),I=e._data(K.parent[0],"events");L.className=z.cl.fullScreen+" "+z.cl.uiFullScreen+" "+z.cl.parent;L.origParent=M;K.parent=z.controls.fullScreen=e(L).append(M.children()).appendTo(y);t.bind("resize",function(){t.trigger("jSResize")}).bind("jSResize",function(){this.w=t.width();this.h=t.height();K.parent.width(this.w).height(this.h);z.sheetSyncSize();O.resizeScroll()}).trigger("jSResize");M.trigger("sheetFullScreen",[true]);for(var N in I){for(var u=0;u<I[N].length;u++){K.parent.bind(N,I[N][u].handler)}}}},renameSheet:function(u){if(w(u)){return false}if(u>-1){z.sheetTab()}return true},switchSheet:function(u){if(w(u)){return false}if(u==-1){z.addSheet()}else{if(u!=z.i){z.setActiveSheet(u);z.calc(u);z.sheetSyncSize();z.obj.pane().resizeScroll();z.cellSetHome()}}return true},tuneTableForSheetUse:function(L){var I=e(L);z.controls.table[z.i]=I.addClass(z.cl.table).addClass(z.cl.uiTable).attr("id",z.id+z.i).attr("border","1px").attr("cellpadding","0").attr("cellspacing","0");z.formatTable(L);z.sheetDecorateRemove(false,I);z.controls.tables=z.obj.tables().add(L);var M=I.attr("data-frozenatrow")*1,u=I.attr("data-frozenatcol")*1;if(!z.s.frozenAt[z.i]){z.s.frozenAt[z.i]={row:0,col:0}}if(M){z.s.frozenAt[z.i].row=M}if(u){z.s.frozenAt[z.i].col=u}},createSpreadsheet:function(L,I){L.spreadsheet=z.spreadsheets[I]=[];var M=z.rows(L),N=M.length-1,u;if(N<0){return}do{u=M[N].children.length-1;if(u<0){return}do{var O=M[N].children[u];if(N>0&&u>0){z.createCell(I,N,u)}else{if(u==0&&N>0){O.type="bar";O.entity="left";O.innerHTML=N;O.className=z.cl.barLeft+" "+z.cl.barLeft+"_"+z.i+" "+z.cl.uiBar;O.setAttribute("style","height:"+O.nextSibling.style.height)}if(N==0&&u>0){O.type="bar";O.entity="top";O.innerHTML=i.columnLabelString(u);O.className=z.cl.barTop+" "+z.cl.barTop+"_"+z.i+" "+z.cl.uiBar}if(N==0&&u==0){O.type="bar";O.entity="corner";O.className=z.cl.uiBar+"  "+z.cl.barCorner;z.controls.bar.corner[z.i]=O}}}while(u--)}while(N--)},toggleHideRow:function(u){u=u||z.rowLast;if(!u){return}var L=z.rows()[u],I=z.obj.pane().actionUI;I.toggleHideRow(L,u);z.autoFillerGoToTd()},toggleHideColumn:function(I){I=I||z.colLast;if(!I){return}var u=z.cols()[I],L=z.obj.pane().actionUI;L.toggleHideColumn(u,I);z.autoFillerGoToTd()},rowShowAll:function(){z.obj.pane().actionUI.rowShowAll()},columnShowAll:function(){z.obj.pane().actionUI.columnShowAll()},merge:function(Q){Q=Q||z.highlighted();if(!Q.length){return}var O=[],I=Q[0],N=Q[Q.length-1],V=z.getTdLocation(I),L=z.getTdLocation(N),Y={},T={},S=0,U=0,X=new b(),P=Q.length-1,W,Z,M,u,R;if(V.row){z.setDirty(true);z.setChanged(true);if(V.row<L.row){Y.row=V.row;T.row=L.row;M=I}else{Y.row=L.row;T.row=V.row;M=N}if(M.getAttribute("rowSpan")||M.getAttribute("colSpan")){return false}u=e(M);if(V.col<L.col){Y.col=V.col;T.col=L.col}else{Y.col=L.col;T.col=V.col}U=(T.row-Y.row)+1;S=(T.col-Y.col)+1;R=z.getTdLocation(M);do{Z=Q[P];W=Z.jSCell;if(W.formula||W.value){O.unshift(W.formula?"("+W.formula.substring(1)+")":W.value)}K.parent.one("sheetPreCalculation",function(){if(Z.cellIndex!=R.col||Z.parentNode.rowIndex!=R.row){W.formula=null;W.value="";W.html="";W.defer=M.jSCell;W.calcLast=X;Z.removeAttribute("data-formula");Z.removeAttribute("data-celltype");Z.innerHTML="";Z.style.display="none";Z.colSpan=S-(Z.cellIndex-M.cellIndex);Z.rowSpan=U-(Z.parentNode.rowIndex-M.parentNode.rowIndex)}});z.calcDependencies.call(W)}while(P--);M.jSCell.value=O.join(" ");M.jSCell.formula=(M.jSCell.formula?O.join(" "):"");M.jSCell.calcLast=X;M.style.display="";M.setAttribute("rowSpan",U);M.setAttribute("colSpan",S);z.calcDependencies.call(M.jSCell);z.evt.cellEditDone();z.autoFillerGoToTd(u);z.cellSetActive(u,R)}return true},unmerge:function(u){u=u||z.highlighted();if(!u){return}var L=u[0],P=z.getTdLocation(L),Q=new b(),S=D.max(L.getAttribute("rowSpan")*1,1)-1,I=D.max(L.getAttribute("colSpan")*1,1)-1,O=S+P.row,M,R,N=[];if(S==0&&I==0){return false}do{M=P.col+I;do{R=z.getTd(z.i,O,M)[0];R.style.display="";R.removeAttribute("colSpan");R.removeAttribute("rowSpan");R.jSCell.defer=null;z.calcDependencies.call(R.jSCell,Q);N.push(R)}while(M-->P.col)}while(O-->P.row);z.evt.cellEditDone();z.autoFillerGoToTd(u);z.cellSetActive(u,P);z.themeRoller.cell.setHighlighted(e(N));return true},fillUpOrDown:function(Q,S,U){z.evt.cellEditDone();U=U||z.highlighted(true);if(U.length<1){return false}var N=z.obj.tdActive(),R=new b();if(U.length<1){return false}var O=z.getTdLocation(U[0].td),V=z.getTdLocation(U[U.length-1].td),u=z.getTdLocation(N),L={row:0,col:0},I=S||N[0].jSCell.value,T=false,M=U.length-1,P=function(){};S=S||N[0].jSCell.value;if(M>=0){if(S.charAt&&S.charAt(0)=="="){if(M>=0){do{if(!Q){L.row=u.row-V.row;L.col=u.col-V.col}else{L.row=u.row-O.row;L.col=u.col-O.col}I=z.reparseFormula(S,L);K.parent.one("sheetPreCalculation",function(){U[M].formula=I;U[M].value="";U[M].td.data("formula",I)});z.calcDependencies.call(U[M],R)}while(M--);return true}}else{if((T=!w(I))||I.length>0){if(T&&I!=""){I*=1;if(Q){I-=U.length-1}P=function(){I++}}}do{K.parent.one("sheetPreCalculation",function(){U[M].formula="";U[M].value=I+"";U[M].td.removeData("formula")});z.calcDependencies.call(U[M],R);P()}while(M--);return true}}return false},toTsv:function(U,M,S){U=U||z.highlighted(true);if(U.type){U=[U]}S=S||function(X,W){if(M){K.parent.one("sheetPreCalculation",function(){W.formula="";W.value=""});z.calcDependencies.call(W,R)}};var P=[],T,O,I={},R=new b(),L=U.length-1,V,u;if(L>=0){T=z.getTdLocation(U[0].td);O=z.getTdLocation(U[U.length-1].td);I.row=D.min(T.row,O.row);I.col=D.min(T.col,O.col);do{var N=z.getTdLocation(U[L].td),Q=(U[L].formula?"="+U[L].formula:U[L].value);V=D.abs(N.row-I.row);u=D.abs(N.col-I.col);if(!P[V]){P[V]=[]}if((Q+="").match(/\n/)){Q='"'+Q+'"'}P[V][u]=(Q||"");S.call(U[L].td,N,U[L])}while(L-->0);L=P.length-1;do{P[L]=P[L].join("\t")}while(L-->0);return P.join("\n")}return""},offsetFormulas:function(Q,P,L,O){var I=z.sheetSize(),N={first:{row:1,col:1},last:{row:I.rows,col:I.cols}},M=new b(),u=[];z.cycleCells(function(){var R=this;if(this.formula&&typeof this.formula=="string"&&z.isFormulaEditable(this.td)){this.formula=z.reparseFormula(this.formula,P,Q,L,O);this.td.data("formula","="+this.formula)}u.push(function(){z.calcDependencies.call(R,M,true)})},N.first,N.last);while(u.length){u.pop()()}z.evt.cellEditDone()},reparseFormula:function(N,M,L,u,I){return N.replace(i.regEx.cell,function(P,Q,U,V){if(Q=="SHEET"){return P}M=M||{loc:0,row:0};var O={row:U*1,col:i.columnLabelIndex(Q)},T,S,R={row:U,col:Q,use:false};if(L){if(I){if(u){if(O.col&&O.col==L.col-1){R.col="#REF!";R.use=true}if(O.row&&O.row==L.row-1){R.row="#REF!";R.use=true}if(O.col>=L.col){T=true}if(O.row>=L.row){S=true}}else{if(L.col&&O.col==L.col){R.col="#REF!";R.use=true}if(L.row&&O.row==L.row){R.row="#REF!";R.use=true}if(L.col&&O.col>L.col){T=true}if(L.row&&O.row>L.row){S=true}}if(R.use){return R.col+R.row}if(T){O.col+=M.col;return z.makeFormula(O)}if(S){O.row+=M.row;return z.makeFormula(O)}}else{if(u){if(L.col&&O.col>=L.col){T=true}if(L.row&&O.row>=L.row){S=true}}else{if(L.col&&O.col>L.col){T=true}if(L.row&&O.row>L.row){S=true}}if(T){O.col+=M.col;return z.makeFormula(O)}if(S){O.row+=M.row;return z.makeFormula(O)}}}else{return z.makeFormula(O,M)}return P})},makeFormula:function(I,u){u=e.extend({row:0,col:0},u);I.col+=u.col;I.row+=u.row;if(I.col<0){I.col=0}if(I.row<0){I.row=0}return i.parseCellName(I.col,I.row)},cycleCells:function(M,P,N,L){L=L||z.i;P=P||{row:1,col:1};if(!N){var I=z.sheetSize();N={row:I.rows,col:I.cols}}var O=N.row,u;if(O<P.row){return}do{u=N.col;do{M.call(z.spreadsheets[L][O][u],L,O,u)}while(u-->P.col)}while(O-->P.row)},cycleCellsAll:function(M){var N=z.i,L,I,u;for(L=0;L<=z.sheetCount;L++){z.i=L;I=z.sheetSize();u={row:I.rows,col:I.cols};z.cycleCells(M,{row:0,col:0},u,L)}z.i=N},cycleCellArea:function(R,V,O,N,S){var u={start:{},end:{}},Q,U,W,T,M=z.i,I={cell:[],td:[]},P=z.spreadsheets[M],L=(S?"unshift":"push");if(N){u.start=V;u.end=O}else{u.start.row=D.max(D.min(V.row,O.row),1);u.start.col=D.max(D.min(V.col,O.col),1);u.end.row=D.max(V.row,O.row,1);u.end.col=D.max(V.col,O.col,1)}Q=u.end.row;do{U=u.end.col;W=P[Q]||null;do{if(W){T=W[U]||null;if(T){I.cell[L](T);I.td[L](T.td[0])}}}while(U-->u.start.col)}while(Q-->u.start.row);if(R){R(I)}},formatTable:function(V){var T=K.newColumnWidth,Q=K.colMargin,L=V.children,O=L.length-1,N,M,S,I,R,U,P;if(O>-1){do{switch(L[O].nodeName){case"TBODY":U=true;S=L[O];break;case"COLGROUP":P=true;I=L[O];break}}while(O--)}else{var u=l.createElement("tr");u.appendChild(l.createElement("td"));V.appendChild(u);L=V.children}if(!S){S=l.createElement("tbody");do{S.appendChild(L[0])}while(L.length)}if(!I||I.children.length<1){I=l.createElement("colgroup");V.appendChild(I);V.appendChild(S);R=S.children[0];for(O=0,N=R.children.length;O<N;O++){M=l.createElement("col");I.appendChild(M);M.style.width=T+"px"}for(O=0,N=S.children.length;O<N;O++){S.children[O].style.height=Q+"px"}}V.tBody=S;V.colGroup=I;V.removeAttribute("width");V.style.width=""},checkMinSize:function(N){var L=z.sheetSize(N),O=K.minSize.rows||0,u=K.minSize.cols||0,M=z.obj.pane().actionUI,I=M.frozenAt;O=(I.row>O?I.row+1:O);u=(I.col>u?I.col+1:u);if(L.cols<u){z.controlFactory.addColumnMulti(null,u-L.cols)}if(L.rows<O){z.controlFactory.addRowMulti(null,O-L.rows)}},themeRoller:{start:function(u){z.obj.header().addClass(z.cl.uiControl);z.obj.label().addClass(z.cl.uiControl);z.obj.formula().addClass(z.cl.uiControlTextBox)},cell:{setHighlighted:function(M){M=M||e([]);var u,L=z.highlightedLast.obj,I=z.obj.pane().actionUI;if(L&&L.length>0){u=L.length-1;do{L[u].isHighlighted=false}while(u-->0)}if(M.length>0){u=M.length-1;do{if(!M[u].isHighlighted){M[u].isHighlighted=true;if(!M[u].className.match(z.cl.uiTdHighlighted)){M[u].className+=" "+z.cl.uiTdHighlighted}}}while(u-->0)}z.themeRoller.cell.clearHighlighted.call(M,L);I.redraw()},isHighlighted:function(){return(z.highlightedLast.obj.length?true:false)},clearHighlighted:function(L,I){if(z.themeRoller.cell.isHighlighted()){L=L||z.highlightedLast.obj;if(L&&L.length){var u=L.length-1;do{if(!L[u].isHighlighted||I){L[u].className=L[u].className.replace(z.cl.uiTdHighlighted,"");L[u].isHighlighted=false}}while(u-->0)}}if(this.length){z.highlightedLast.obj=this}else{z.highlightedLast.obj=e([])}}},bar:{style:function(u){e(u).addClass(z.cl.uiBar)},setActive:function(u,I){switch(u){case"top":z.highlightedLast.barTop.removeClass(z.cl.uiBarHighlight);z.highlightedLast.barTop=e(I).addClass(z.cl.uiBarHighlight);break;case"left":z.highlightedLast.barLeft.removeClass(z.cl.uiBarHighlight);z.highlightedLast.barLeft=e(I).addClass(z.cl.uiBarHighlight);break}},clearActive:function(){z.highlightedLast.barLeft.removeClass(z.cl.uiBarHighlight);z.highlightedLast.barLeft=e([]);z.highlightedLast.barTop.removeClass(z.cl.uiBarHighlight);z.highlightedLast.barTop=e([])}},tab:{setActive:function(){this.clearActive();z.obj.tab().addClass(z.cl.uiTabActive)},clearActive:function(){z.obj.tabContainer().find("span."+z.cl.uiTabActive).removeClass(z.cl.uiTabActive)}}},resizable:function(I,u){if(!I.data("resizable")){I.resizable(u)}},busy:[],setBusy:function(u){if(u){z.busy.push(u)}else{z.busy.pop()}},isBusy:function(){return(z.busy.length>0)},draggable:function(I,u){if(!I.data("jSdraggable")){I.data("jSdraggable",true).draggable(u)}},nearest:function(I,u){return e(I).nearest(u)},resizeBar:{top:function(O,L,Q,I){z.obj.barTopControls().remove();var M=l.createElement("div"),P=e(M).addClass(z.cl.barController+" ui-state-highlight").width(O.width()).height(0).prependTo(O),u,N;z.controls.bar.x.controls[z.i]=z.obj.barTopControls().add(P);z.resizableCells(P,{handles:"e",start:function(S,R){z.autoFillerHide();z.setBusy(true);u=z.col(I,L);if(Q.freezeHandleTop){Q.freezeHandleTop.remove()}u.removeAttribute("width")},resize:function(S,R){u.style.width=R.size.width+"px";if(Q.inPlaceEdit){Q.inPlaceEdit.goToTd()}},stop:function(S,R){z.setBusy(false);Q.resizeScroll();z.followMe();z.setDirty(true)},minWidth:32});N=M.children[0];N.style.height=O.outerHeight()+"px";N.style.position="absolute"},left:function(M,P,L,T){z.obj.barLeftControls().remove();var O=M.offset(),U=l.createElement("div"),R=e(U).addClass(z.cl.barController+" ui-state-highlight").prependTo(M).offset({top:O.top,left:O.left}),S=M[0],N=M.next()[0],V=N.parentNode,I=l.createElement("div"),u=e(I).addClass("jSBarControllerChild").height(M.height()).prependTo(R),Q;z.controls.bar.y.controls[z.i]=z.obj.barLeftControls().add(R);z.resizableCells(u,{handles:"s",start:function(){z.autoFillerHide();z.setBusy(true);if(L.freezeHandleLeft){L.freezeHandleLeft.remove()}V.removeAttribute("height");S.removeAttribute("height");N.removeAttribute("height")},resize:function(X,W){U.style.height=N.style.height=S.style.height=V.style.height=W.size.height+"px";if(L.inPlaceEdit){L.inPlaceEdit.goToTd()}},stop:function(X,W){z.setBusy(false);L.resizeScroll();z.followMe();z.setDirty(true)},minHeight:15});Q=I.children[0];Q.style.width=M.outerWidth()+"px";Q.style.position="absolute"},corner:function(){}},sheetDecorateRemove:function(I,u){u=u||z.obj.tables();u=(I?u.clone():u);u.find("td."+z.cl.uiTdActive).removeClass(z.cl.uiTdActive);u.find("td."+z.cl.uiTdHighlighted).removeClass(z.cl.uiTdHighlighted);return u},labelUpdate:function(I,u){if(!u){I=i.parseCellName(I.col,I.row);if(I){z.obj.label().text(I)}}else{z.obj.label().text(I)}},cellEdit:function(P,M,L){if(z.cellLast.td.length<1){}z.autoFillerNotGroup=true;z.evt.cellEditDone();if(!P.length){return}var N=z.getTdLocation(P),u=P[0].jSCell,I;if(!u){return}if(u.uneditable){return}z.trigger("sheetCellEdit",[u]);if(!P.is(z.cellLast.td)){z.followMe(P)}else{z.autoFillerGoToTd(P)}z.labelUpdate(N);if(u.formula){I="="+u.formula}else{I=u.value}var O=z.obj.formula().val(I).blur();z.cellSetActive(P,N,M,false,null,L)},cellSetActive:function(N,P,I,R,O,L){P=P||z.getTdLocation(N);if(P.col!=H){z.cellLast.td=N;z.cellLast.row=z.rowLast=P.row;z.cellLast.col=z.colLast=P.col;if(!L){z.themeRoller.cell.setHighlighted(N);z.highlightedLast.start=P;z.highlightedLast.end=P}if(!N.length){return}z.themeRoller.bar.setActive("left",N[0].barLeft);z.themeRoller.bar.setActive("top",N[0].barTop);var Q,S;switch(K.cellSelectModel){case"excel":case"gdrive":Q=function(){};S=function(){};break;case"oo":Q=function(T){if(z.isCell(T)){z.cellEdit(e(T))}};S=function(){};break}if(I){var u={},M=z.obj.pane();u.last=P;M.onmousemove=function(ab){ab=ab||g.event;var ac=ab.target||ab.srcElement;if(z.isBusy()){return false}var T=z.highlightedLast.end=z.getTdLocation(ac),ad=true;if(T.col<1||T.row<1||T.col==G||T.row==G){return false}if(R){ad=false;if(P.col==T.col||P.row==T.row){ad=true}}if((u.last.col!=T.col||u.last.row!=T.row)&&ad){Q(ac);z.cycleCellArea(function(af){z.themeRoller.cell.setHighlighted(af.td)},P,T,false,true)}z.followMe(e(ac));var W=ab.clientY,X=ab.clientX,Y=M.$enclosure.offset(),ae=z.getTdLocation(ac),Z=ae.row,V=ae.col,U=false,aa;if(w(Z)||w(V)){return false}if(W>Y.top){U=true;Z--}if(X>Y.left){U=true;V--}if(U){if(Z<1||V<1){return false}aa=z.spreadsheets[z.i][Z][V];z.followMe(e(aa.td),true)}u.last=T;return true};l.onmouseup=function(){M.onmousemove=null;M.onmousemove=null;M.onmouseup=null;l.onmouseup=null;if(O){O()}}}}},colLast:0,rowLast:0,cellLast:{td:e([]),row:0,col:0,isEdit:false},highlightedLast:{obj:e([]),start:{row:0,col:0},end:{row:0,col:0},barLeft:e([]),barTop:e([])},highlightedLastOrdered:function(){var I=this.highlightedLast,u={start:{},end:{}};u.start.row=h.min(I.start.row,I.end.row);u.start.col=h.min(I.start.col,I.end.col);u.end.row=h.max(I.start.row,I.end.row);u.end.col=h.max(I.start.col,I.end.col);return u},cellStyleToggle:function(P,Q,N){N=N||z.highlighted();if(N.length<1){return false}z.setDirty(true);var L,u,O=N.length-1,R=z.obj.cellsEdited(),I=z.controls.cellsEdited[z.i],M;if(O>=0){M=N[0].className.match(P);do{L=N[O];u=e(L);if(Q){u.removeClass(Q)}if(M){u.removeClass(P)}else{u.addClass(P)}if(!L.jSCell.edited){L.jSCell.edited=true;I=R.add(L.jSCell)}}while(O--);return true}return false},cellTypeToggle:function(M,I){I=I||z.highlighted(true);if(I.length<1){return}var L=I.length-1,u=I[L].cellType==M;if(L>=0){do{if(u){I[L].cellType=null}else{I[L].cellType=M}I[L].calcLast=0;z.updateCellValue.call(I[L])}while(L--)}},fontReSize:function(P,N){N=N||z.highlighted();if(N.length<1){return false}var L=0;switch(P){case"up":L=1;break;case"down":L=-1;break}var M,u,O=N.length-1,R,Q=z.obj.cellsEdited(),I=z.controls.cellsEdited[z.i];if(O>=0){do{M=N[O];u=e(M);R=(u.css("font-size")+"").replace("px","")*1;u.css("font-size",((R||10)+L)+"px");if(!M.jSCell.edited){M.jSCell.edited=true;I=Q.add(M.jSCell)}}while(O--);return true}return false},callStack:0,updateCellValue:function(Q,M,O){var L,R,P,N;Q=Q||0;M=M||-1;O=O||-1;if(M>-1){if(!(L=z.spreadsheets[Q])){return K.error({error:z.msg.notFoundSheet})}if(!(R=L[M])){return K.error({error:z.msg.notFoundRow})}if(!(P=R[O])){return K.error({error:z.msg.notFoundColumn})}}else{P=this}if(P===undefined){throw new o("cell doesn't exist")}P.oldValue=P.value;if(P.result){delete P.result}switch(P.state[P.state.length-1]){case"updating":return K.error({error:z.msg.loopDetected});case"updatingDependencies":return(P.valueOverride!=H?P.valueOverride:P.value)}if(P.defer){return z.updateCellValue.call(P.defer)}P.state.push("updating");P.fnCount=0;P.result=null;if(P.calcLast!=z.calcLast||P.calcDependenciesLast!=z.calcDependenciesLast){P.valueOverride=null;P.calcLast=z.calcLast;P.calcDependenciesLast=z.calcDependenciesLast;P.needsUpdated=true;P.calcCount++;if(P.formula){try{if(P.formula.charAt(0)=="="){P.formula=P.formula.substring(1)}var u;if(z.callStack){if(!P.formulaParser){P.formulaParser=g.Formula(z.cellHandler)}u=P.formulaParser}else{u=z.formulaParser}z.callStack++;u.setObj(P);P.result=u.parse(P.formula)}catch(I){P.result=I.toString()}z.callStack--;if(P.result&&P.cellType&&K.cellTypeHandlers[P.cellType]){P.result=K.cellTypeHandlers[P.cellType].call(P,P.result)}z.filterValue.call(P)}else{if(P.value&&P.cellType&&K.cellTypeHandlers[P.cellType]){P.result=K.cellTypeHandlers[P.cellType].call(P,P.value);z.filterValue.call(P)}else{if(P.value!=H&&P.value.charAt){N=z.s.cellStartingHandlers[P.value.charAt(0)];if(N){P.valueOverride=N.call(P,P.value)}else{N=z.s.cellEndHandlers[P.value.charAt(P.value.length-1)];if(N){P.valueOverride=N.call(P,P.value)}}}z.filterValue.call(P)}}}P.needsUpdated=false;P.state.pop();return(P.valueOverride!=H?P.valueOverride:P.value)},updateCellDependencies:function(){if((this.state||(this.state=[])).length){return}this.state.push("updatingDependencies");var M=this.dependencies||[];this.dependencies=[];var I=M.length-1;if(I>-1){do{var u=M[I],L=z.getTdLocation(u.td);u.calcDependenciesLast=0;z.updateCellValue.call(u);if(L.row>0&&L.col>0){z.updateCellDependencies.call(u)}}while(I--)}this.state.pop()},filterValue:function(){var u,I;if(this.result!=H){this.value=this.result.valueOf();I=this.result.html}else{if(typeof this.value=="string"&&this.value.length>0){u=K.encode(this.value)}}this.td.html(I||u||this.value)},cellHandler:{variable:function(){if(arguments.length){var M=arguments[0],I=arguments[1],N=z.s.formulaVariables,L,u;switch(M.toLowerCase()){case"true":u=new r(true);u.html="TRUE";return u;case"false":u=new r(false);u.html="FALSE";return u}if(L=N[M]&&!I){return L}else{if(L&&I){return L[I]}else{return""}}}},time:function(I,u){return j.fromString(I,u)},number:function(u){switch(typeof u){case"number":return u;case"string":if(!w(u)){return u*1}case"object":if(u.getMonth){return f.toCentury(u)}}return u},numberInverted:function(L){var I=z.cellHandler.number(L),u=new q(I.valueOf()*-1);if(I.html){u.html=I.html}return u},performMath:function(P,O,N){var M,L,Q=true,u=true,S=[],R,I=function(T){return T};switch(M=(typeof O.valueOf())){case"number":break;case"string":if(!w(O)){O*=1}else{Q=false}break;case"object":if(O.getMonth){O=f.toCentury(O);I=f.get}else{Q=false}break;default:Q=false}switch(L=(typeof N.valueOf())){case"number":break;case"string":if(!w(N)){N*=1}else{u=false}break;case"object":if(N.getMonth){N=f.toCentury(N)}else{u=false}break;default:u=false}if(!Q){S.push("not a number: "+O);O=0}if(!u){S.push("not a number: "+N);N=0}if(S.length){}switch(P){case"+":R=O+N;break;case"-":R=O-N;break;case"/":R=O/N;if(R==Infinity||R==G){R=0}break;case"*":R=O*N;break;case"^":R=D.pow(O,N);break}return I(R)},cellValue:function(L){var I=i.parseLocation(L),u;u=z.cellHandler.createDependency.call(this,this.sheet,I);z.updateCellValue.call(u);return(u.valueOverride!=H?u.valueOverride:u.value)},createDependency:function(I,N){var L,M,u;if(!(L=z.spreadsheets[I])){return null}if(!(M=L[N.row])){return null}if(!(u=M[N.col])){return null}if(!u.dependencies){u.dependencies=[]}if(e.inArray(this,u.dependencies)<0){u.dependencies.push(this)}return u},cellRangeValue:function(u,I){u=i.parseLocation(u);I=i.parseLocation(I);var R=[],M=D.max(u.row,I.row),Q=D.min(u.row,I.row),L=D.max(u.col,I.col),N=L,O=D.min(u.col,I.col),P;if(M>=Q||L>=O){do{L=N;do{P=z.spreadsheets[this.sheet][M][L];z.cellHandler.createDependency.call(this,this.sheet,{row:M,col:L});R.unshift(z.updateCellValue.call(P))}while(L-->O)}while(M-->Q);return R}return R},fixedCellValue:function(u){u=u.replace(/\$/g,"");return z.cellHandler.cellValue.call(this,u)},fixedCellRangeValue:function(I,u){I=I.replace(/\$/g,"");u=u.replace(/\$/g,"");return z.cellHandler.cellRangeValue.call(this,I,u)},remoteCellValue:function(I,M){var L=i.parseLocation(M),u=i.parseSheetLocation(I);z.cellHandler.createDependency.call(this,u,L);return z.updateCellValue(u,L.row,L.col)},remoteCellRangeValue:function(N,O,I){N=i.parseSheetLocation(N);O=i.parseLocation(O);I=i.parseLocation(I);var u=[];for(var M=O.row;M<=I.row;M++){for(var L=O.col;L<=I.col;L++){u.push(z.updateCellValue(N,M,L))}}return[u]},callFunction:function(L,I,M){L=L.toUpperCase();I=I||[];if(L.indexOf("BTC")==0){I[I.length]=M}if(e.sheet.fn[L]){this.fnCount++;var u=e.sheet.fn[L].apply(this,I);return u}else{return K.error({error:"Function "+L+" Not Found"})}}},cellLookupHandlers:{fixedCellValue:function(u){return[z.sheet,i.parseLocation(u),i.parseLocation(u)]},fixedCellRangeValue:function(I,L,u){return[i.parseSheetLocation(I),i.parseLocation(L),i.parseLocation(u)]},cellValue:function(u){},cellRangeValue:function(I,L,u){return[z.sheet,i.parseLocation(L),i.parseLocation(u)]},remoteCellValue:function(u,I){return[z.sheet,i.parseLocation(I),i.parseLocation(I)]},remoteCellRangeValue:function(I,L,u){return[i.parseSheetLocation(I),i.parseLocation(L),i.parseLocation(u)]},callFunction:function(){if(arguments[0]=="VLOOKUP"||arguments[0]=="HLOOKUP"&&arguments[1]){if(arguments[1]&&arguments[1][1]){return arguments[1][1]}return[]}}},cellLookup:function(){var u=Formula(e.extend({},z.cellHandler,z.cellLookupHandlers));u.setObj(this);var L=u.parse(this.formula),M=[];for(var N=L[1].row;N<=L[2].row;N++){for(var I=L[1].col;I<=L[2].col;I++){M.push(z.getCell(N,I,L[0]))}}return M},calcLast:0,calcDependenciesLast:0,calc:function(u,L){u=u||z.i;if(z.readOnly[u]||z.isChanged(u)===false&&!L||!z.formulaParser){return false}z.calcLast=new b();var I=z.spreadsheetToArray(null,u);i.calc(u,I,z.updateCellValue);z.trigger("sheetCalculation",[{which:"spreadsheet",sheet:I,index:u}]);z.setChanged(false);return true},calcCell:function(u,N,I,M){u=u||z.i;if(z.readOnly[u]||z.isChanged(u)===false&&!M||!z.formulaParser){return false}z.calcLast=new b();var L=z.spreadsheetToArray(null,u);z.updateCellValue(u,N,I);z.trigger("sheetCalculation",[{which:"spreadsheet",sheet:L,index:u}]);z.setChanged(false);return true},calcVisiblePos:{row:-1,col:-1},calcVisibleInit:function(R){R=R||z.i;z.calcLast=z.calcLast||new b();var I=z.spreadsheetToArray(null,R)||[],N=z.updateCellValue,L=h.min,M=K.initCalcRows,u=K.initCalcCols,P=L(I.length-1,M),S,Q,O={row:-1,col:-1};if(P>0){O.row=P;do{if(P>0&&(S=I[P])!==undefined){O.col=Q=L(S.length-1,u);if(Q>0){do{N.apply(S[Q])}while(Q-->1)}}}while(P-->1)}this.calcVisiblePos=O;z.trigger("sheetCalculation",[{which:"spreadsheet",sheet:I,index:R}]);z.setChanged(false)},calcVisibleRow:function(u,W){W=W||z.i;var N=z.spreadsheetToArray(null,W)||[],I=u.scrolledArea.end,S=z.updateCellValue,Q=h.min,R=K.initCalcRows,L=K.initCalcCols,M=I.row+R,P=I.col+L,U=Q(N.length-1,M),X,V,O=this.calcVisiblePos,T={row:U,col:O.col};if(U>0){do{if((X=N[U])!==undefined){V=Q(X.length-1,P);if(V>0){do{S.apply(X[V])}while(V-->1)}}}while(U-->O.row)}this.calcVisiblePos=T;z.trigger("sheetCalculation",[{which:"spreadsheet",sheet:N,index:W}]);z.setChanged(false)},calcVisibleCol:function(u,X){X=X||z.i;var N=z.spreadsheetToArray(null,X)||[],I=u.scrolledArea.end,S=z.updateCellValue,Q=h.min,R=K.initCalcRows,L=K.initCalcCols,M=I.row+R,P=I.col+L,U=Q(N.length-1,M),Y,W,V,O=this.calcVisiblePos,T={row:O.row,col:O.col};if(U>0){do{if(U>0&&(Y=N[U])!==undefined){W=Q(Y.length-1,P);if((V=Y[W])!==undefined){S.apply(V)}}}while(U-->1)}this.calcVisiblePos=T;z.trigger("sheetCalculation",[{which:"spreadsheet",sheet:N,index:X}]);z.setChanged(false)},calcDependencies:function(L,I){L=L||new b();z.calcDependenciesLast=L;if(!I){var u=this;z.undo.createCells([this],function(M){z.trigger("sheetPreCalculation",[{which:"cell",cell:u}]);z.setDirty(true);z.setChanged(true);z.updateCellValue.call(u);z.updateCellDependencies.call(u);z.trigger("sheetCalculation",[{which:"cell",cell:u}]);return M})}else{z.trigger("sheetPreCalculation",[{which:"cell",cell:this}]);z.setDirty(true);z.setChanged(true);z.updateCellValue.call(this);z.updateCellDependencies.call(this);z.trigger("sheetCalculation",[{which:"cell",cell:this}])}},addSheet:function(u){u=u||{rows:25,cols:10};if(u){z.evt.cellEditAbandon();z.setDirty(true);z.controlFactory.sheetUI(z.obj.ui,e.sheet.makeTable(u),z.sheetCount);z.setActiveSheet(z.sheetCount);z.sheetCount++;z.sheetSyncSize();z.obj.pane().resizeScroll();z.trigger("sheetAdd",[z.i]);z.cellSetHome()}},deleteSheet:function(I){var N=I||z.i,M=z.controls.enclosures.toArray(),u;M.splice(N,1);z.obj.barHelper().remove();z.obj.enclosure().remove();z.controls.enclosures=e(M);z.obj.menus().remove();z.obj.tabContainer().children().eq(z.i).remove();z.spreadsheets.splice(N,1);z.controls.autoFiller.splice(N,1);z.controls.bar.helper.splice(N,1);z.controls.bar.corner.splice(N,1);z.controls.bar.x.controls.splice(N,1);z.controls.bar.x.handleFreeze.splice(N,1);z.controls.bar.x.controls.splice(N,1);z.controls.bar.x.menu.splice(N,1);if(z.controls.bar.x.menuParent&&z.controls.bar.x.menuParent[N]){z.controls.bar.x.menuParent.splice(N,1)}z.controls.bar.x.parent.splice(N,1);z.controls.bar.x.td.splice(N,1);z.controls.bar.y.controls.splice(N,1);z.controls.bar.y.handleFreeze.splice(N,1);z.controls.bar.y.controls.splice(N,1);z.controls.bar.y.menu.splice(N,1);if(z.controls.bar.y.menuParent&&z.controls.bar.y.menuParent[N]){z.controls.bar.y.menuParent.splice(N,1)}z.controls.bar.y.parent.splice(N,1);z.controls.bar.y.td.splice(N,1);z.controls.barMenuLeft.splice(N,1);z.controls.barMenuTop.splice(N,1);z.controls.barLeft.splice(N,1);z.controls.barTop.splice(N,1);z.controls.barTopParent.splice(N,1);z.controls.chart.splice(N,1);z.controls.tdMenu.splice(N,1);z.controls.enclosure.splice(N,1);z.controls.fullScreen=null;z.controls.inPlaceEdit.splice(N,1);z.controls.menus.splice(N,1);z.controls.menuLeft.splice(N,1);z.controls.menuRight.splice(N,1);z.controls.pane.splice(N,1);z.controls.tables.splice(N,1);z.controls.table.splice(N,1);for(u=N+1;u<z.controls.tab.length;++u){var L=z.controls.tab[u].get(0);L.i--}z.controls.tab.splice(N,1);z.controls.toggleHide.x.splice(N,1);z.controls.toggleHide.y.splice(N,1);z.readOnly.splice(N,1);z.i=0;z.sheetCount--;z.sheetCount=D.max(z.sheetCount,0);if(z.sheetCount==0){z.addSheet()}z.setActiveSheet(z.i);z.setDirty(true);z.setChanged(true);z.trigger("sheetDelete",[N])},deleteRow:function(N,I){var M,P,u,O,L=z.sheetSize();if(N){P=u=N}else{P=D.min(z.highlightedLast.start.row,z.highlightedLast.end.row);u=D.max(z.highlightedLast.start.row,z.highlightedLast.end.row)}O=(u-P)+1;if(P<1||L.cols<2||O>=L.rows){return}M=u;do{z.getTd(z.i,M,1).parent().remove()}while(P<M--);z.controls.bar.y.td[z.i].splice(P,O);z.spreadsheets[z.i].splice(P,O);z.refreshRowLabels(P);z.setChanged(true);z.offsetFormulas({row:P,col:0},{row:-O,col:0},false,true);z.setDirty(true);z.evt.cellEditAbandon();z.obj.pane().resizeScroll();z.trigger("sheetDeleteRow",M)},deleteColumn:function(P){var N,u,M,R,T=z.sheetSize();if(P){u=M=P}else{u=D.min(z.highlightedLast.start.col,z.highlightedLast.end.col);M=D.max(z.highlightedLast.start.col,z.highlightedLast.end.col)}R=(M-u)+1;if(u<1||T.cols<2||R>=T.cols){return}N=M;z.obj.barHelper().remove();do{var S=z.obj.table(),I=z.col(S[0],N),Q=z.obj.barTop(N).remove(),O=I.tds,L=O.length-1;do{e(O[L]).remove()}while(L--);z.obj.barTop(N).remove();e(I).remove()}while(u<N--);z.controls.bar.x.td[z.i].splice(u,R);L=z.spreadsheets[z.i].length-R;do{z.spreadsheets[z.i][L].splice(u,R)}while(L-->1);z.refreshColumnLabels(u);z.setChanged(true);z.offsetFormulas({row:0,col:u},{row:0,col:-R},false,true);z.setDirty(true);z.evt.cellEditAbandon();z.obj.pane().resizeScroll();z.trigger("sheetDeleteColumn",N)},sheetTab:function(I,L){var u="";if(I){u=z.obj.table().attr("title")||z.msg.sheetTitleDefault.replace(/[{]index[}]/gi,z.i+1);if(L){L(u)}return u}else{if(z.isSheetEditable()&&K.editableNames){title(u,L);return null}}},tdNotVisible:function(I){var L=z.obj.pane(),M=I[0],T={top:0,bottom:L.clientHeight,left:0,right:L.clientWidth},Q=I.width(),O=I.height(),R={top:M.offsetTop,bottom:M.offsetTop+O,left:M.offsetLeft,right:M.offsetLeft+Q},u=I.parent();if(!M.col){return false}var S=e(M.barTop).is(":hidden"),N=u.is(":hidden"),P={up:N,down:R.bottom>T.bottom&&O<=L.clientHeight,left:S,right:R.right>T.right&&Q<=L.clientWidth};if(P.up||P.down||P.left||P.right){return P}return false},followMe:function(L,u){L=L||z.obj.tdActive();if(!L.length){return}var M=z.obj.pane(),I=M.actionUI;z.setBusy(true);I.putTdInView(L[0]);z.setBusy(false);if(!u){z.autoFillerGoToTd(L)}},autoFillerGoToTd:function(M,I,u){if(!K.autoFiller){return}M=M||z.obj.tdActive();var N=M[0];if(N&&N.type=="cell"){I=I||N.clientHeight;u=u||N.clientWidth;if(!N.offsetHeight||!N.offsetWidth||!N.clientHeight||!N.clientWidth){z.autoFillerHide();return}var L=M.position();z.obj.autoFiller().show().css("top",((L.top+(I||M.height())-3)+"px")).css("left",((L.left+(u||M.width())-3)+"px"))}},autoFillerHide:function(){if(!K.autoFiller){return}z.obj.autoFiller().hide()},setActiveSheet:function(L){L=L||0;if(z.cellLast.row>0||z.cellLast.col>0){z.evt.cellEditDone();z.obj.formula().val("")}var I=z.obj.enclosures(),u=I.length-1,M;z.autoFillerHide();if(u>0){do{if(L!=u){M=I[u];M._scrollLeft=M._scrollLeft||M.scrollUI.scrollLeft;M._scrollTop=M._scrollTop||M.scrollUI.scrollTop;M.style.display="none"}}while(u-->0)}z.i=L;M=I[L];M.style.display="";z.themeRoller.tab.setActive();z.readOnly[L]=(M.table.className||"").match(/\breadonly\b/i)!=null;M.pane.resizeScroll(true);M.scrollUI.scrollLeft=M._scrollLeft||M.scrollUI.scrollLeft;M.scrollUI.scrollTop=M._scrollTop||M.scrollUI.scrollTop;M._scrollLeft=M._scrollTop=null;M.scrollUI.onscroll()},openSheet:function(L){var N=L.length-1,u=[],I=function(){z.setBusy(true);var S=z.controlFactory.header(),R=z.controlFactory.ui(),O=z.controlFactory.sheetAdder(),P=z.controlFactory.tabContainer(),Q;z.sheetCount=L.length-1;S.ui=R;S.tabContainer=P;R.header=S;R.sheetAdder=O;R.tabContainer=P;P.header=S;P.ui=R;K.parent.append(S).append(R).append(O).append(P);for(Q=0;Q<L.length;Q++){new M(z,Q,R,L[Q])}},M=function(T,P,S,R){var Q=this;this.i=P;this.ui=S;this.table=R;this.isLast=(P==N);this.jS=T;if(e.sheet.max){var O=T.tableSize(R);if(O.rows>e.sheet.max||O.cols>e.sheet.max){T.trigger("sheetMaxSize",[R,P]);K.confirm(T.msg.maxSizeBrowserLimitationOnOpen,function(){Q.load()})}else{this.load()}}else{this.load()}};M.prototype={load:function(){z.controlFactory.sheetUI(this.ui,this.table,this.i);z.sheetCount++;u.push(this.i);z.trigger("sheetOpened",[this.i]);if(this.isLast){this.loaded()}},loaded:function(){var P=this.jS,O=this.ui;P.resizableSheet(K.parent,{minWidth:K.parent.width()*0.1,minHeight:K.parent.height()*0.1,start:function(){P.setBusy(true);P.obj.enclosure().hide();O.sheetAdder.hide();O.tabContainer.hide()},stop:function(){P.obj.enclosure().show();O.sheetAdder.show();O.tabContainer.show();P.setBusy(false);P.sheetSyncSize();P.obj.pane().resizeScroll()}});P.sheetSyncSize();P.setActiveSheet(0);P.setDirty(false);P.setBusy(false);while(u.length){P.calcVisibleInit(P.i=u.pop())}P.trigger("sheetAllOpened")}};if(z.isDirty){K.confirm(z.msg.openSheet,I)}else{I()}},newSheet:function(){K.title="";K.parent.html(e.sheet.makeTable()).sheet(K)},clearMenu:function(){a.find("ul").hide()},toggleHeader:function(u){if(u){z.obj.header().show()}else{z.obj.header().hide()}},cellSetHome:function(){var M={row:1,col:1},L=false,I,u=false;if(!z.cellLast.isEdit||L){var N=z.getTd(z.i,M.row,M.col);if(N){z.cellEdit(N,null,u);return false}}return true},sheetSyncSize:function(){var N=K.parent[0].clientHeight;if(!N){N=400;K.parent.height(N)}else{if(N<200){N=200;K.parent.height(N)}}N-=z.obj.header().outerHeight();N-=z.obj.tabContainer().outerHeight()+z.s.boxModelCorrection;var I=K.parent[0].clientWidth,P=z.obj.ui.style,M=(N-g.scrollBarSize.height-K.boxModelCorrection)+"px",u=(I-g.scrollBarSize.width)+"px",O=N+"px",L=I+"px";z.obj.panes().each(function(){var S=this.style,R=this.actionUI.scrollUI.style,Q=this.enclosure.style;S.height=M;S.width=u;Q.height=R.height=O;Q.width=R.width=L});P.height=O;P.width=L},cellChangeStyle:function(L,M,u){u=u||z.highlighted(true);if(u.length<1){return false}z.setDirty(this);var I=u.length-1;if(I>=0){z.undo.createCells(u,function(N){do{N[I].td.css(L,M)}while(I--);return N});return true}return false},cellFind:function(u){function I(M){var L=z.obj.table().children("tbody").children("tr");if(M){var N=L.children('td:contains("'+M+'")');if(N.length<1){N=L.children('td:contains("'+M.toLowerCase()+'")')}if(N.length<1){N=L.children('td:contains("'+M.toUpperCase()+'")')}N=N.eq(0);if(N.length>0){z.cellEdit(N)}else{dialog("FYI","Data not found")}}}if(!u){K.prompt(z.msg.cellFind,I)}else{I(u)}},cellSetActiveBar:function(R,L,M){var W=z.sheetSize(),O=D.min(L,M),T=D.max(L,M),u={},S={},V=function(X){switch(K.cellSelectModel){case"oo":this.row=(X?u.row:S.row);this.col=(X?u.col:S.col);this.td=z.getTd(z.i,this.row,this.col);if(!this.td.is(z.cellLast.td)){z.cellEdit(this.td,false,true)}break;default:this.row=(X?S.row:u.row);this.col=(X?S.col:u.col);this.td=z.getTd(z.i,this.row,this.col);if(!this.td.is(z.cellLast.td[0])){z.cellEdit(this.td,false,true)}break}},N=[],P=z.obj.pane().actionUI.scrolledArea,Q=z.obj.table(),I,U;switch(R){case"top":u.row=P.end.row;u.col=O;S.row=P.end.row;S.col=T;z.highlightedLast.start.row=1;z.highlightedLast.start.col=O;z.highlightedLast.end.row=W.rows;z.highlightedLast.end.col=T;I=T;do{N.push(z.col(Q[0],I))}while(I-->O);break;case"left":u.row=O;u.col=P.end.col;S.row=T;S.col=P.end.col;z.highlightedLast.start.row=O;z.highlightedLast.start.col=1;z.highlightedLast.end.row=T;z.highlightedLast.end.col=W.cols;U=T;do{N.push(z.getTd(z.i,U,1)[0].parentNode)}while(U-->O);break;case"corner":u.row=1;u.col=1;S.col=W.cols;S.row=W.rows;N.push(Q[0]);break}new V(L>M);z.themeRoller.cell.setHighlighted(e(N))},getTdRange:function(M,R,P,Q){z.cellLast.isEdit=true;var I=function(T){if(T.first.col>T.last.col||T.first.row>T.last.row){return{first:i.parseCellName(T.last.col,T.last.row),last:i.parseCellName(T.first.col,T.first.row)}}else{return{first:i.parseCellName(T.first.col,T.first.row),last:i.parseCellName(T.last.col,T.last.row)}}},O=function(W){var T=I(W),V=R+"";V=(V.match(/=/)?V:"="+V);if(P||V.charAt(V.length-1)!="("){V=V+(P?P:"")+"("}var X,U="";if(T.first!=T.last){X=T.first+":"+T.last}else{X=T.first}if(V.charAt(V.length-1)=="("){U=")"}return V+X+U},u="",L,N,S;if(M){L={first:z.getTdLocation([M.target])};N=z.obj.table().mousemove(function(T){L.last=z.getTdLocation([T.target]);u=O(L);if(!Q){z.obj.formula().val(u);z.obj.inPlaceEdit().value=u}});x.one("mouseup",function(){N.unbind("mousemove");return u})}else{S=z.highlighted().not(z.obj.tdActive());if(S.length){L={first:z.getTdLocation(S.first()),last:z.getTdLocation(S.last())};u=O(L);if(!Q){z.obj.formula().val(u);z.obj.inPlaceEdit().val(u)}return u}else{return""}}return""},getTd:function(N,P,I){var L=z.obj.tables()[N],u,M,O;if(!L||!(u=L.tBody)||!(M=u.children[P])||!(O=M.children[I])){O=l.createElement("td")}return e(O)},getTdLocation:function(I){var u={col:0,row:0};I=I||"";if(!I&&!I[0]){return u}I=I[0]||I;if(I.parentNode==H||I.parentNode.rowIndex<0){return u}return{col:parseInt(I.cellIndex),row:parseInt(I.parentNode.rowIndex)}},getBarIndex:{left:function(u){u=u||{};if(!u.parentNode||w(u.parentNode.rowIndex)){return -1}else{return u.parentNode.rowIndex}},top:function(u){u=u||{};if(w(u.cellIndex)){return -1}else{return u.cellIndex}},corner:function(){return 0}},time:{now:new b(),last:new b(),diff:function(){return D.abs(D.ceil(this.last.getTime()-this.now.getTime())/1000).toFixed(5)},set:function(){this.last=this.now;this.now=new b()},get:function(){return this.now.getHours()+":"+this.now.getMinutes()+":"+this.now.getSeconds()}},changed:[],isChanged:function(u){return z.changed[u||z.i]},setChanged:function(u){z.changed[z.i]=u},isDirty:false,setDirty:function(u){z.dirty=u},appendToFormula:function(u){var L=z.obj.formula(),I=L.val();if(I.charAt(0)!="="){I="="+I}L.val(I+u)},undo:{manager:(g.UndoManager?new UndoManager():{undo:F,redo:F,register:F,notLoaded:true}),cells:[],id:0,createCells:function(u,I,N){if(z.undo.manager.notLoaded){this.createCells=function(O,P,Q){return P(O)};return this.createCells(u,I,N)}if(N==H){z.undo.id++;N=z.undo.id}var L=new v(u).clone().cells,M=(I?new v(I(u)).clone().cells:L);L.id=N;M.id=N;z.undo.manager.add({undo:function(){z.undo.removeCells(L,N)},redo:function(){z.undo.createCells(M,null,N)}});if(N!=z.undo.id||!I){z.calcLast=new b();z.undo.draw(M)}return true},removeCells:function(I,M){var L=0,u=-1;if(I.id===M){u=L}if(u!==-1){}z.undo.draw(I)},draw:function(L){var I;for(I=0;I<L.length;I++){var N=L[I],M=z.getTdLocation(N.td),u=z.spreadsheets[N.sheet][M.row][M.col];u.value=N.value;u.formula=N.formula;u.td=N.td;u.dependencies=N.dependencies;u.needsUpdated=N.needsUpdated;u.calcCount=N.calcCount;u.sheet=N.sheet;u.calcLast=N.calcLast;u.html=N.html;u.state=N.state;u.jS=N.jS;u.calcDependenciesLast=N.calcDependenciesLast;u.td.attr("style",N.style);u.td.attr("class",N.cl);z.updateCellValue.call(u);z.cellEdit(N.td,null,false)}}},cols:function(u){u=u||z.obj.table()[0];if(!u){return[]}if(!u.colGroup){return[]}if(!u.colGroup.children){return[]}return u.colGroup.children},tables:function(S,N){S=S||z.obj.tables();var R=[],L=S.length-1,I,U,Q,u,V,M,T,O,P;do{U=(N?l.body.removeChild(S[L]):S[L].cloneNode(true));if((u=U.children[0])&&(V=u.children[0])){u.removeChild(V)}if(Q=U.children[1]){O=Q.children;T=O[0];Q.removeChild(T);I=O.length-1;do{P=O[I];M=P.children[0];P.removeChild(M)}while(I-->0)}R[L]=U}while(L-->0);return z.sheetDecorateRemove(false,e(R))},col:function(I,u){I=I||z.obj.table()[0];var L=z.cols(I);if(u===H){u=L.length-1}return L[u]},rowTds:function(I,u){I=I||z.obj.table();var L=z.rows(I);if(!L.length){return[]}if(u==H){u=L.length-1}if(!L[u]){return[]}if(!L[u].children){return[]}return L[u].children},rows:function(u){u=u||z.obj.table()[0];if(!u){return[]}if(!u.tBody){return[]}if(!u.tBody.children){return[]}return u.tBody.children},highlighted:function(I){var M=z.highlightedLast.obj||e([]),N=[],u,L;if(!(u=M)||!M.length||!(u=u[0])||!u.tagName){return I?N:e(N)}switch(u.tagName){case"TD":L=M.length-1;do{N.unshift(I?M[L].jSCell:M[L])}while(L-->0);break;case"TR":L=M.length-1;do{if(M[L].tds){N=N.concat(I?M[L].jSCells:M[L].tds)}}while(L-->0);break;case"COL":M=M.filter("col");L=M.length-1;do{if(M[L].tds){N=N.concat(I?M[L].jSCells:M[L].tds)}}while(L-->0);break;case"TABLE":N=(I?u.jSCells:u.tds);break}return I?N:e(N)},sheetSize:function(I){I=I||z.obj.table()[0];var u=z.rowTds(I),L=z.getTdLocation(u[u.length-1]);return{cols:L.col,rows:L.row}},test:function(){var u=z.highlighted(true);console.log(z.obj.enclosure())},sortVerticalSelectAscending:function(){if(confirm("Do you want to extend your selection?")){z.sortVertical();return true}else{z.sortVerticalSingle(false);return true}},sortVerticalSelectDescending:function(){if(confirm("Do you want to extend your selection?")){z.sortVertical();return false}else{z.sortVerticalSingle(true);return false}},sortVertical:function(S){var Q=z.highlighted(true),N=Q[0].td.parent().prev(),u=Q.length,L=new b(),P=true,T=[],V=[],O,R=0,U,I,M;while(R<u){U=Q[R];M=U.td[0];if(!isNaN(U.value)){I=(new q(U.value.valueOf()))}else{P=false;I=(new n(U.value.valueOf()))}I.loc=z.getTdLocation(M);I.row=M.parentNode;I.col=M;I.cell=U;T.push(I);R++}if(S){if(P==false){T.sort(function(X,W){return W-X})}else{T.sort();T.reverse()}}else{if(P==true){T.sort(function(X,W){return X-W})}else{T.sort()}}z.undo.createCells(Q);while(O=T.length){I=T.pop();V=z.spreadsheets[z.i].splice(I.row.rowIndex,1);U=I.cell;U.value=I.valueOf();U.calcLast=0;I.row.parentNode.removeChild(I.row);N.after(I.row);I.row.children[0].innerHTML=N[0].rowIndex+O;z.spreadsheets[z.i].splice(N[0].rowIndex+1,0,V[0]);z.calcDependencies.call(U,L,true)}z.undo.createCells(Q)},sortVerticalSingle:function(O){var M=z.highlighted(true),N=M.length,L=0,I=[],u;while(L<N){I.push(M[L].value);L++}if(O){I.sort(function(Q,P){return P-Q})}else{I.sort(function(Q,P){return Q-P})}while(M.length){u=M.pop();u.value=I[M.length];u.calcLast=0;z.updateCellValue.call(u);z.updateCellDependencies.call(u)}},sortHorizontalSelectAscending:function(){if(confirm("Do you want to extend your selection?")){z.sortHorizontal();return true}else{z.sortHorizontalSingle(false);return true}},sortHorizontalSelectDescending:function(){if(confirm("Do you want to extend your selection?")){z.sortHorizontal();return false}else{z.sortHorizontalSingle(true);return false}},sortHorizontal:function(S){var Q=z.highlighted(true),Y=Q[0].td[0],U=Y.cellIndex,u=Y.table.colGroup,Z=z.sheetSize().rows,I=Q.length,M=new b(),P=true,V=[],O,R=0,W,X,L,T,N;while(R<I){W=0;X=Q[R];N=X.td[0];if(!isNaN(X.value)){L=new q(X.value.valueOf())}else{P=false;L=new n(X.value.valueOf())}L.tds=[];L.loc=z.getTdLocation(N);L.tr=N.parentNode;L.td=N;L.cell=X;while(W<=Z){L.tds.push(z.obj.pane().table.children[1].children[W].children[N.cellIndex]);W++}V.push(L);R++}if(S){if(P==false){V.sort(function(ab,aa){return aa-ab})}else{V.sort();V.reverse()}}else{if(P==true){V.sort(function(ab,aa){return ab-aa})}else{V.sort()}}z.undo.createCells(Q);while(V.length){L=V.pop();while(L.tds.length>1){N=L.tds.pop();T=N.parentNode;X=z.spreadsheets[z.i][T.rowIndex].splice(N.cellIndex,1);T.insertBefore(N,T.children[U]);N.col=u.children[V.length+N.cellIndex-1];N.barTop=N.col.bar;X.value=N.jSCell.value;X.calcLast=M;z.spreadsheets[z.i][T.rowIndex].splice(N.cellIndex,0,X[0]);z.calcDependencies.call(X,M,true)}}z.undo.createCells(Q)},sortHorizontalSingle:function(O){var M=z.highlighted(true),N=M.length,L=0,I=[],u;while(L<N){I.push(M[L].value);L++}if(O){I.sort(function(Q,P){return P-Q})}else{I.sort(function(Q,P){return Q-P})}while(M.length){u=M.pop();u.value=I[M.length];u.calcLast=0;z.updateCellValue.call(u);z.updateCellDependencies.call(u)}},tableSize:function(L){L=L||z.obj.table()[0];var u=(L.children[0].nodeName!="TBODY"?L.children[1]:L.children[0]).children,I=u[u.length-1].children,N=I[I.length-1],M=z.getTdLocation(N);return{cols:M.col,rows:M.row}},toggleState:function(u){if(K.allowToggleState){var I=u||z.tables();if(K.editable){z.evt.cellEditAbandon();z.trigger("sheetSave",[I])}z.setDirty(false);z.setChanged(true);K.editable=!K.editable;z.kill();K.parent.html(I).sheet(K);K=null}},setCellRef:function(I){function u(N){if(N){z.s.formulaVariables[N]=z.updateCellValue(z.i,L.row,L.col)}}var M=z.obj.tdActive(),L=z.getTdLocation(M);if(I){u(I)}else{K.prompt(z.msg.setCellRef,u)}},formulaParser:null};z.setBusy(true);K.parent[0].jS=z;if(!g.console){g.console={log:function(){}}}if(!g.scrollBarSize){g.scrollBarSize=e.sheet.getScrollBarSize()}if(g.Formula){z.formulaParser=g.Formula(z.cellHandler)}K.origHtml=K.parent.children().detach();K.parent.addClass(z.cl.parent);K.parent.bind("sheetSwitch",function(L,I,u){z.switchSheet(u)}).bind("sheetRename",function(L,I,u){z.renameSheet(u)});K.width=(K.width?K.width:K.parent.width());K.height=(K.height?K.height:K.parent.height());if(!e.nearest){z.nearest=F}z.resizableCells=z.resizableSheet=z.resizable;if(!e.ui){z.resizable=z.resizableCells=z.resizableSheet=z.draggable=F}else{if(!K.resizableCells){z.resizableCells=F}if(!K.resizableSheet){z.resizableSheet=F}}if(!e.support.boxModel){K.boxModelCorrection=0}if(!K.barMenus){z.controlFactory.barMenuTop=z.controlFactory.barMenuLeft=F}if(!K.freezableCells){z.controlFactory.barHandleFreeze.top=z.controlFactory.barHandleFreeze.left=F}if(K.calcOff){z.calc=F}if(!g.Raphael){i.chart=F}t.resize(function(){if(z&&!z.isBusy()){K.width=K.parent.width();K.height=K.parent.height();z.sheetSyncSize()}});if(e.sheet.fn){e.sheet.fn=e.extend(e.sheet.fn,K.formulaFunctions);if(e.sheet.advancedfn){e.sheet.fn=e.extend(e.sheet.fn,e.sheet.advancedfn)}if(e.sheet.financefn){e.sheet.fn=e.extend(e.sheet.fn,e.sheet.financefn)}if(e.sheet.bitcoin){e.sheet.fn=e.extend(e.sheet.fn,e.sheet.bitcoin)}}K.title=K.title||K.parent.attr("title")||"";z.s=K;K.parent.addClass(z.cl.uiParent);if(K.origHtml.length){z.openSheet(K.origHtml)}else{z.openSheet(e(l.createElement("table")))}z.setBusy(false);return z},makeTable:function(F,v,t){var D=l;F=F||{rows:25,cols:10};v=v||120;t=t||15;var E=l.createElement("table"),u=l.createElement("colgroup"),C=l.createElement("tbody"),z="width:"+v+"px;",x="height:"+t+"px;",B,w,A,y;A=F.cols;do{w=l.createElement("col");w.setAttribute("style",z);u.appendChild(w)}while(A-->1);A=F.rows;do{B=l.createElement("tr");B.setAttribute("style",x);y=F.cols;do{B.appendChild(l.createElement("td"))}while(y-->1);C.appendChild(B)}while(A-->1);E.appendChild(u);E.appendChild(C);return E},killAll:function(){if(e.sheet){var t=e.sheet.instance;if(t){for(var u=0;u<t.length;u++){if(t[u]&&t[u].kill){t[u].kill()}}e.sheet.instance=[]}}},scrollLocker:function(u){var t=e.sheet.instance;t[u].obj.panes().each(function(v){var w;e(w=this.scrollUI).scroll(function(y){var x=t.length-1,z;if(x>-1){do{z=t[x].controls.enclosure[v][0].scrollUI;if(this!==z){z.scrollLeft=w.scrollLeft;z.scrollTop=w.scrollTop}}while(x--)}})})},switchSheetLocker:function(t){e.each(e.sheet.instance,function(){this.s.parent.bind("sheetSwitch",function(w,v,u){e.each(e.sheet.instance,function(){this.setActiveSheet(u)})})})},I:function(){var t=0;if(this.instance){t=(this.instance.length===0?0:this.instance.length-1)}else{this.instance=[]}return t},getScrollBarSize:function(){var z=l,C=e(l.createElement("p")).css({width:"100%",height:"100%"}),B=e(l.createElement("div")).css({position:"absolute",width:"100px",height:"100px",top:"0",left:"0",visibility:"hidden",overflow:"hidden"}).append(C);e(l.body).append(B);var v=C.width(),y=C.height();B.css("overflow","scroll");var t=C.width(),x=C.height();if(v==t&&B[0].clientWidth){t=B[0].clientWidth}if(y==x&&B[0].clientHeight){x=B[0].clientHeight}B.detach();var A=v-t,u=y-x;return{width:A||15,height:u||15}},debugPositionBox:function(t,A,v,u,z){u=u||"#"+h.floor(h.random()*16777215).toString(16);if(v){var w=e([]);w=w.add(this.debugPositionBox(v.left,v.top,null,u,"top-left"));w=w.add(this.debugPositionBox(v.right,v.top,null,u,"top-right"));w=w.add(this.debugPositionBox(v.left,v.bottom,null,u,"bottom-left"));w=w.add(this.debugPositionBox(v.right,v.bottom,null,u,"bottom-right"));return w}return e('<div style="width: 10px; height: 10px; position: absolute;"></div>').css("top",(A-5)+"px").css("left",(t+5)+"px").css("background-color",u).click(function(){console.log(z||"none")}).appendTo("body")}};var i=e.sheet.engine={calc:function(v,t,w){t=t||[];var x=t.length-1,u;if(x>0){do{if(x>0&&t[x]){u=t[x].length-1;if(u>0){do{w(v,x,u)}while(u--)}}}while(x--)}},parseLocation:function(u){for(var t=0;t<u.length;t++){if(u.charCodeAt(t)<=57){break}}return{row:parseInt(u.substring(t)),col:i.columnLabelIndex(u.substring(0,t))}},parseSheetLocation:function(t){return((t+"").replace("SHEET","")*1)-1},parseCellName:function(t,u){return i.columnLabelString(t)+(u||"")},alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),columnLabels:{},columnLabelIndex:function(t){return this.columnLabels[t.toUpperCase()]},columnIndexes:[],columnLabelString:function(w){if(!this.columnIndexes.length){var y="",x,v,u,t;x=v=u=-1;for(t=1;t<16385;++t){y="";++u;if(u==26){u=0;++v;if(v==26){v=0;++x}}if(x>=0){y+=this.alphabet[x]}if(v>=0){y+=this.alphabet[v]}if(u>=0){y+=this.alphabet[u]}this.columnIndexes[t]=y;this.columnLabels[y]=t}}return this.columnIndexes[w]||""},regEx:{n:/[\$,\s]/g,cell:/\$?([a-zA-Z]+|[#]REF[!])\$?([0-9]+|[#]REF[!])/gi,range:/\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCell:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCellRange:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,sheet:/SHEET/i,amp:/&/g,gt:/</g,lt:/>/g,nbsp:/&nbsp;/g},chart:function(w){var v=this.jS,t=this;function u(x,y){if(!x){if(y){x=0}else{x=""}}else{if(y){x=d.toNumbers(x)}else{x=d.flatten(x)}}return x}w=e.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:"",td:this.td,chart:e(l.createElement("div")).addClass(v.cl.chart).mousedown(function(){w.td.mousedown()}),gR:{}},w);v.controls.chart[v.i]=v.obj.chart().add(w.chart);w.data=u(w.data,true);w.x.data=u(w.x.data,true);w.y.data=u(w.y.data,true);w.legend=u(w.legend);w.x.legend=u(w.x.legend);w.y.legend=u(w.y.legend);w.legend=(w.legend?w.legend:w.data);v.s.parent.one("sheetCalculation",function(){var y=w.chart.width(),x=w.chart.height(),z=Raphael(w.chart[0]);if(w.title){z.text(y/2,10,w.title).attr({"font-size":20})}switch(w.type){case"bar":w.gR=z.barchart(y/8,x/8,y*0.8,x*0.8,w.data,w.legend).hover(function(){this.flag=z.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":w.gR=z.hbarchart(y/8,x/8,y*0.8,x*0.8,w.data,w.legend).hover(function(){this.flag=z.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":w.gR=z.linechart(y/8,x/8,y*0.8,x*0.8,w.x.data,w.y.data,{nostroke:false,axis:"0 0 1 1",symbol:"circle",smooth:true}).hoverColumn(function(){this.tags=z.set();if(this.symbols.length){for(var A=0,B=this.y.length;A<B;A++){this.tags.push(z.tag(this.x,this.y[A],this.values[A],160,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[A].attr("fill")}]))}}},function(){this.tags&&this.tags.remove()});break;case"pie":w.gR=z.piechart(y/2,x/2,(y<x?y:x)/2,w.data,{legend:w.legend}).hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].attr({r:7.5});this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label){this.label[0].animate({r:5},500,"bounce");this.label[1].attr({"font-weight":400})}});break;case"dot":w.gR=z.dotchart(y/8,x/8,y*0.8,x*0.8,w.x.data,w.y.data,w.data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:w.x.data.length-1,axisystep:w.y.data.length-1,axisxlabels:(w.x.legend?w.x.legend:w.x.data),axisylabels:(w.y.legend?w.y.legend:w.y.data),axisxtype:" ",axisytype:" "}).hover(function(){this.marker=this.marker||z.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.marker.show()},function(){this.marker&&this.marker.hide()});break}w.gR.mousedown(function(){w.td.mousedown().mouseup()});w.chart.mousemove(function(){w.td.mousemove();return false})});return w.chart}};var m=e.sheet.fn={ISNUMBER:function(u){var t;if(!isNaN(u.valueOf())){t=new r(true);t.html="TRUE";return t}t=new r(false);t.html="FALSE";return t},N:function(t){if(t==null){return 0}if(t instanceof b){return t.getTime()}if(typeof(t)=="object"){t=t.toString()}if(typeof(t)=="string"){t=parseFloat(t.replace(i.regEx.n,""))}if(isNaN(t)){return 0}if(typeof(t)=="number"){return t}if(t==true){return 1}return 0},VERSION:function(){return this.jS.version},ABS:function(t){return h.abs(m.N(t))},CEILING:function(u,t){t=t||1;return(parseInt(u/t)*t)+t},EVEN:function(t){t=h.round(t);var u=(t%2==0);if(!u){if(t>0){t++}else{t--}}return t},EXP:function(t){return h.exp(t)},FLOOR:function(v,u){u=u||1;if((v<0&&u>0)||(v>0&&u<0)){var t=new q(0);t.html="#NUM";return t}if(v>=0){return h.floor(v/u)*u}else{return h.ceil(v/u)*u}},INT:function(t){return h.floor(m.N(t))},LN:function(t){return h.log(t)},LOG:function(t,u){u=u||10;return h.log(t)/h.log(u)},LOG10:function(t){return m.LOG(t)},MOD:function(t,v){var u=t%v;if(v<0){u*=-1}return u},ODD:function(t){var w=false;if(t>0){t=h.floor(h.round(t));w=true}else{t=h.ceil(t)}var u=h.abs(t);if((u%2)==0){u++}if(w){return u}else{return -u}},PI:function(){return h.PI},POWER:function(t,u){return h.pow(t,u)},SQRT:function(t){return h.sqrt(t)},RAND:function(){return h.random()},RND:function(){return h.random()},ROUND:function(w,u){var t=h.pow(10,u||0);return h.round(w*t)/t},ROUNDDOWN:function(u,t){var w=(u<0);u=h.abs(u);t=t||0;u=h.floor(u*h.pow(10,t))/h.pow(10,t);return(w?-u:u)},ROUNDUP:function(u,t){var w=(u<0);u=h.abs(u);t=t||0;u=h.ceil(u*h.pow(10,t))/h.pow(10,t);return(w?-u:u)},SUM:function(){var w=0,t=d.toNumbers(arguments),u=t.length-1;if(u<0){return 0}do{w+=t[u]*1}while(u--);return w},TRUNC:function(t,u){u=u||0;t=t+"";if(u==0){return t.split(".").shift()}if(t.match(".")){if(u==1){t=t.substr(0,t.length-1)}else{if(u==-1){t=t.split(".").shift();t=t.substr(0,t.length-1)+"0"}}}return t},AVERAGE:function(t){return m.SUM(arguments)/m.COUNT(arguments)},AVG:function(t){return m.AVERAGE(t)},COUNT:function(){var w=0,t=d.toNumbers(arguments),u=t.length-1;if(u<0){return w}do{if(t[u]!==null){w++}}while(u--);return w},COUNTA:function(){var w=0,t=d.flatten(arguments),u=t.length-1;if(u<0){return w}do{if(t[u]){w++}}while(u--);return w},MAX:function(){var u=d.toNumbers(arguments),t=u[0],w=u.length-1;if(w<0){return 0}do{t=(u[w]>t?u[w]:t)}while(w--);return t},MIN:function(){var t=d.toNumbers(arguments),w=t[0],u=t.length-1;if(u<0){return 0}do{w=(t[u]<w?t[u]:w)}while(u--);return w},ASC:function(t){return t.charCodeAt(0)},CHAR:function(t){return n.fromCharCode(t)},CLEAN:function(t){var u=new c("[cG\x1BcLcJcMcIcK\x07\x1B\f\n\r\t\v]","g");return t.replace(u,"")},CODE:function(t){return m.ASC(t)},CONCATENATE:function(){var v=d.flatten(arguments),u="",t=this;jQuery.each(v,function(w){u+=v[w]});return u},DOLLAR:function(w,u,y){u=u||2;y=y||"$";var t=new q(w),x=m.FIXED(w,u,false);if(w>=0){t.html=y+x}else{t.html="("+y+x.slice(1)+")"}return t},FIXED:function(x,w,u){w=(w===undefined?2:w);var y=h.pow(10,w),t,x=h.round(x*y)/y;t=new n(x.toFixed(w));t.html=Globalize.format(x,"n"+w);if(u){t.html=t.html.replace(Globalize.culture().numberFormat[","],"")}return t},LEFT:function(t,u){u=u||1;return t.substring(0,u)},LEN:function(t){if(!t){return 0}return t.length},LOWER:function(t){return t.toLowerCase()},MID:function(u,w,t){if(!u||!w||!t){return this.jS.s.error({error:"ERROR"})}return u.substring(w-1,t+w-1)},REPLACE:function(u,x,v,w){if(!u||!x||!v||!w){return this.jS.s.error({error:"ERROR"})}var t=u.split("");t.splice(x-1,v);t.splice(x-1,0,w);return t.join("")},REPT:function(u,x){var t="";for(var w=0;w<x;w++){t+=u}return t},RIGHT:function(t,u){u=u||1;return t.substring(t.length-u,t.length)},SEARCH:function(v,t,w){w=w||0;if(w){t=t.split("");t.splice(0,w-1);t=t.join("")}var u=t.search(v);if(u<0){return this.jS.s.error({error:"#VALUE!"})}return w+(w?0:1)+u},SUBSTITUTE:function(w,t,v,x){x=x||0;t=new c(t,"g");var u=1;w=w.replace(t,function(z,B,C,A){var y=z;if(x){if(u>=x){y=v}}else{y=v}u++;return y});return w},TEXT:function(){return this.jS.s.error({error:"Not Yet Implemented"})},UPPER:function(t){return t.toUpperCase()},VALUE:function(t){if(jQuery.isNumeric(t)){return t*=1}else{return this.jS.s.error({error:"#VALUE!"})}},NOW:function(){var t=new b();t.html=f.toString(t);return t},TODAY:function(){var u=new b(),t=new q(f.toCentury(u)-1);t.html=f.toString(u,"d");return t},WEEKENDING:function(u){var t=new b();t=new b(t.getFullYear(),t.getMonth(),t.getDate()+5-t.getDay()-((u||0)*7));t.html=f.toString(t,"d");return t},WEEKDAY:function(u,v){u=f.get(u);var t=u.getDay();v=(v?v:1);switch(v){case 3:switch(t){case 0:return 7;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6}break;case 2:switch(t){case 0:return 6;case 1:return 0;case 2:return 1;case 3:return 2;case 4:return 3;case 5:return 4;case 6:return 5}break;case 1:t++;break}return t},WEEKNUM:function(t){t=f.get(t);return f.week(t)+1},YEAR:function(t){t=f.get(t);return t.getFullYear()},DAYSFROM:function(u,v,t){return h.floor((new b()-new b(u,(v-1),t))/f.dayDiv)},DAYS:function(x,v){var u=f.get(x),t=f.get(v),w=1000*60*60*24;return h.round(h.abs(u.getTime()-t.getTime())/w)},DAY:function(t){t=f.get(t);return t.getDate()},DAYS360:function(y,v,A){y=f.get(y);v=f.get(v);var t=y.getDate(),x=v.getDate(),w=f.isLastDayOfMonth(y),z=f.isLastDayOfMonth(v),u=f.diffMonths(y,v);if(A){t=h.min(t,30);x=h.min(x,30)}else{if(w){t=30}if(z){if(t<30){u++;x=1}else{x=30}}}return(u*30)+(x-t)},DATE:function(w,x,u){var v=new b(w,x-1,u),t=new q(f.toCentury(v));t.html=f.toString(v,"d");return t},DATEVALUE:function(u){u=f.get(u);var t=new q(f.toCentury(u));t.html=f.toString(u,"d");return t},EDATE:function(v,u){v=f.get(v);v.setMonth(v.getMonth()+u);var t=new q(f.toCentury(v));t.html=f.toString(v,"d");return t},EOMONTH:function(v,u){v=f.get(v);v.setMonth(v.getMonth()+u+1);v=new b(v.getFullYear(),v.getMonth(),0);var t=new q(f.toCentury(v));t.html=f.toString(v,"d");return t},HOUR:function(t){t=j.fromMath(t);return t.hour},MINUTE:function(t){return j.fromMath(t).minute},MONTH:function(t){t=f.get(t);return t.getMonth()+1},SECOND:function(t){return j.fromMath(t).second},TIME:function(t,y,u){u=(u?u:0);y=(y?y:0);t=(t?t:0);if(u&&u>60){var v=(((u/60)+"").split(".")[0])*1;u=u-(v*60);y+=v}if(y&&y>60){var x=(((y/60)+"").split(".")[0])*1;y=y-(x*60);t+=x}var w=(t*60*60*1000)+(y*60*1000)+(u*1000);return w/f.dayDiv},TIMEVALUE:function(t){if(!isNaN(t)){return t}if(/([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm)/.test(t)){return j.fromString(t,true)}else{if(/([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?/.test(t)){return j.fromString(t)}}return 0},WORKDAY:function(u,x,w){var y={1:true,2:true,3:true,4:true,5:true},u=f.get(u),x=(x&&!isNaN(x)?x:0),z=0,v=0,t=u,B;if(w){if(!jQuery.isArray(w)){w=[w]}w=d.flatten(w);var A={};jQuery.each(w,function(C){if(w[C]){A[f.toString(f.get(w[C]),"d")]=true}});w=A}else{w={}}while(v<x){t=new b(t.setDate(t.getDate()+1));if(y[t.getDay()]){if(!w[f.toString(t,"d")]){v++}}z++}B=new q(f.toCentury(t));B.html=f.toString(t,"d");return B},YEARFRAC:function(t,x,w){t=f.get(t);x=f.get(x);if(!t||!x){return this.jS.s.error({error:"#VALUE!"})}w=(w?w:0);this.html=[];var v=f.diff(t,x,w),u=f.calcAnnualBasis(t,x,w);return v/u},AND:function(){var u=arguments,v,t=this;e.each(u,function(w){if(u[w].valueOf()!==true&&v==undefined){v=m.FALSE()}});if(!v){v=m.TRUE()}return v},FALSE:function(){var t=new r(false);t.html="FALSE";return t},IF:function(v,u,t){if(v.valueOf()){return u}else{return t}},NOT:function(u){var t;if(!u.valueOf()){t=new r(true);t.html="TRUE"}else{t=new r(false);t.html="FALSE"}return t},OR:function(){var w=arguments,t,x=w.length-1,u;if(x>-1){do{u=w[x].valueOf();if(u){t=new r(true);t.html="TRUE";return t}}while(x--)}t=new r(false);t.html="FALSE";return t},TRUE:function(){var t=new r(true);t.html="TRUE";return t},GREATER:function(v,u){var t;if(v>u){t=new r(true);t.html="TRUE"}else{t=new r(false);t.html="FALSE"}return t},LESS:function(v,u){var t;if(v<u){t=new r(true);t.html="TRUE"}else{t=new r(false);t.html="FALSE"}return t},EQUAL:function(v,u){var t;if(v.valueOf()==u.valueOf()){t=new r(true);t.html="TRUE"}else{t=new r(false);t.html="FALSE"}return t},GREATER_EQUAL:function(v,u){var t;if(v>=u){t=new r(true);t.html="TRUE"}else{t=new r(false);t.html="FALSE"}return t},LESS_EQUAL:function(v,u){var t;if(v<=u){t=new r(true);t.html="TRUE"}else{t=new r(false);t.html="FALSE"}return t},IMG:function(u){var t=new n("");t.html=e(l.createElement("img")).attr("src",u);return t},TRIM:function(t){if(typeof(t)=="string"){t=e.trim(t)}return t},HYPERLINK:function(v,u){u=u||"LINK";var t=new n(u);t.html=e(l.createElement("a")).attr("href",v).attr("target","_new").text(u);return t},DROPDOWN:function(){var D=this,z=this.jS,C,y=this.td.children().detach(),A,w=e(D.td),B,u,E;if(!y.length||D.needsUpdated){C=d.flatten(arguments);C=d.unique(C);A=z.getTdLocation(D.td);u="dropdown"+this.sheet+"_"+A.row+"_"+A.col+"_"+z.I;B=l.createElement("select");B.setAttribute("name",u);B.setAttribute("id",u);B.className="jSDropdown";B.cell=this;B.onmouseup=function(){z.cellEdit(w)};B.onchange=function(){D.value=this.value;z.calcDependencies.call(D,D.calcDependenciesLast)};z.controls.inputs[z.i]=z.obj.inputs().add(B);for(var x=0;x<(C.length<=50?C.length:50);x++){if(C[x]){var t=l.createElement("option");t.setAttribute("value",C[x]);t.text=t.innerText=C[x];B.appendChild(t)}}if(!z.s.editable){B.setAttribute("disabled",true)}else{z.s.parent.bind("sheetKill",function(){w.text(D.value=B.value)})}B.value=D.value||C[0];B.onchange()}if(typeof D.value!="object"){E=new n(D.value)}E.html=B;return E},RADIO:function(){var G=this,A=this.jS,F,z=this.td.children().detach(),C,w,B,t,x,u,H;if(!z.length||G.needsUpdated){F=d.flatten(arguments);F=d.unique(F);C=A.getTdLocation(G.td);w=e(G.td);B=[];u="radio"+this.sheet+"_"+C.row+"_"+C.col+"_"+A.I;x=l.createElement("span");x.className="jSRadio";x.onmousedown=function(){A.cellEdit(w)};x.jSCell=G;A.controls.inputs[A.i]=A.obj.inputs().add(x);for(var y=0;y<(F.length<=25?F.length:25);y++){if(F[y]){var E=l.createElement("input"),D=l.createElement("span");E.setAttribute("type","radio");E.setAttribute("name",u);E.className=u;E.value=F[y];E.onchange=function(){G.value=jQuery(this).val();A.calcDependencies.call(G,G.calcDependenciesLast)};B.push(E);if(F[y]==G.value){E.setAttribute("checked","true");E.onchange()}D.textContent=D.innerText=F[y];x.appendChild(E);x.input=E;D.onclick=function(){e(this).prev().click()};x.appendChild(D);x.appendChild(l.createElement("br"))}}t=e(B);if(!A.s.editable){G.value=t.filter(":checked").val();t.attr("disabled",true)}else{A.s.parent.bind("sheetKill",function(){G.value=t.filter(":checked").val();w.text(G.value)})}}if(typeof G.value!="object"){H=new n(G.value)}H.html=x;return H},CHECKBOX:function(B){if(e.isArray(B)){B=B[0]}var C=this,x=this.jS,w=this.td.children().detach(),z,y,u,A,t,D;if((!w.length||C.needsUpdated)){z=x.getTdLocation(C.td);y=e([]);u=e(C.td);t="checkbox"+this.sheet+"_"+z.row+"_"+z.col+"_"+x.I;y=l.createElement("input");y.setAttribute("type","checkbox");y.setAttribute("name",t);y.className=t;y.value=B;y.onchange=function(){if(e(this).is(":checked")){C.value=B}else{C.value=""}x.calcDependencies.call(C,C.calcDependenciesLast)};if(!x.s.editable){y.setAttribute("disabled","true")}else{x.s.parent.bind("sheetKill",function(){C.value=(C.value=="true"||e(y).is(":checked")?B:"");u.text(C.value)})}w=l.createElement("span");w.className="SCheckbox";w.appendChild(y);A=l.createElement("span");A.textContent=A.innerText=B;w.appendChild(A);w.appendChild(l.createElement("br"));w.onmousedown=function(){x.cellEdit(u)};w.cell=C;x.controls.inputs[x.i]=x.obj.inputs().add(w);if(B==C.value){y.setAttribute("checked",true);y.onchange()}}D=new n(C.value=="true"||e(y).is(":checked")?B:"");D.html=w;return D},BARCHART:function(u,v,w){var t=new n("");t.html=i.chart.call(this,{type:"bar",data:u,legend:v,title:w});return t},HBARCHART:function(u,v,w){var t=new n("");t.html=i.chart.call(this,{type:"hbar",data:u,legend:v,title:w});return t},LINECHART:function(v,u){var t=new n("");t.html=i.chart.call(this,{type:"line",x:{data:v},y:{data:u},title:""});return t},PIECHART:function(u,v,w){var t=new n("");t.html=i.chart.call(this,{type:"pie",data:u,legend:v,title:w});return t},DOTCHART:function(z,x,u,w,v,y){var t=new n("");t.html=i.chart.call(this,{type:"dot",data:(u?u:z),x:{data:z,legend:w},y:{data:(x?x:z),legend:(v?v:w)},title:y});return t},CELLREF:function(t){return(this.jS.spreadsheets[t]?this.jS.spreadsheets[t]:"Cell Reference Not Found")},CALCTIME:function(w,u){w=w||"";u=u||"";var t=this,v=this.jS;this.jS.s.parent.one("sheetCalculation",function(){v.time.last=v.calcLast;t.td.text(w+v.time.diff()+u)});return""},HLOOKUP:function(A,y,x,u){var z=this.jS,w=this.jS.cellLookup.call(this),t={html:"#N/A",value:""};x=x||1;u=u!==undefined?u:true;if(isNaN(A)){var v=y[0].indexOf(A);if(v>-1){t=z.updateCellValue(w[v].sheet,x,z.getTdLocation(w[v].td).col)}}else{d.getClosestNum(A,y[0],function(D,C){var B=z.updateCellValue(w[C].sheet,x,z.getTdLocation(w[C].td).col);if(u){t=B}else{if(B==A){t=B}}})}return t},VLOOKUP:function(A,y,x,u){var z=this.jS,w=this.jS.cellLookup.call(this),t={html:"#N/A",value:""};u=u!==undefined?u:true;if(isNaN(A)){var v=y[0].indexOf(A);if(v>-1){t=z.updateCellValue(w[v].sheet,x,z.getTdLocation(w[v].td).col)}}else{d.getClosestNum(A,y[0],function(D,C){var B=z.updateCellValue(w[C].sheet,z.getTdLocation(w[C].td).row,x);if(u){t=B}else{if(B==A){t=B}}})}return t},THISROWCELL:function(t){var u=this.jS,v=u.getTdLocation(this.td);if(isNaN(t)){t=i.columnLabelIndex(t)}return u.updateCellValue(this.sheet,v.row,t)},THISCOLCELL:function(v){var t=this.jS,u=t.getTdLocation(this.td);return t.updateCellValue(this.sheet,v,u.col)}};var p={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,C:67,F:70,N:78,O:79,S:83,V:86,X:88,Y:89,Z:90};var d=g.arrHelpers={math:h,toNumbers:function(t){t=this.flatten(t);var u=t.length-1;if(u<0){return[]}do{if(t[u]){t[u]=e.trim(t[u]);if(isNaN(t[u])){t[u]=0}else{t[u]=t[u]*1}}else{t[u]=0}}while(u--);return t},unique:function(t){var v=[],u=t.length;for(var x=0;x<u;x++){for(var w=x+1;w<u;w++){if(t[x]===t[w]){w=++x}}v.push(t[x])}return v},flatten:function(t){var x=[];for(var v=0,u=t.length;v<u;v++){var w=Object.prototype.toString.call(t[v]).split(" ").pop().split("]").shift().toLowerCase();if(w){x=x.concat(/^(array|collection|arguments|object)$/.test(w)?this.flatten(t[v]):t[v])}}return x},insertAt:function(t,v,u){e(v).each(function(){if(u>-1&&u<=t.length){t.splice(u,0,this)}});return t},closest:function(x,u,v,t){x=x||[];u=u||0;v=v||0;t=t||x.length-1;var w;while(true){w=((v+t)>>1);if(w===t||w===v){return x[w]}if(x[w]>u){t=w}else{if(x[w]<u){v=w}else{return x[w]}}}},getClosestNum:function(v,t,x){var w=0,u,A,z,y;if(t.length){A=t[0];u=w;for(w;w<t.length;w++){z=h.abs(v-A);y=h.abs(v-t[w]);if(y<z){u=w;A=t[w]}z=null;y=null}if(x){return x(A,u)}return A}return false}};var f={dayDiv:86400000,math:h,toCentury:function(t,u){u=u||86400000;return this.math.round(this.math.abs((new b(1900,0,-1))-t)/u)},get:function(u,v){v=v||86400000;if(u.getMonth){return u}else{if(isNaN(u)){return new b(Globalize.parseDate(u))}else{u*=v;var t=(new b(1900,0,-1))*1;u+=t;u=new b(u);return u}}},week:function(t,v){v=v||86400000;var u=new b(t.getFullYear(),0,1);return this.math.ceil((((t-u)/v)+u.getDay()+1)/7)},toString:function(t,u){if(!u){return Globalize.format(t)}return Globalize.format(t,Globalize.culture().calendar.patterns[u])},diff:function(x,u,w,v){v=v||86400000;switch(w){case 0:return this.days360Nasd(x,u,0,true);case 1:case 2:case 3:var t=this.math.abs(u-x)/v;return t;case 4:return this.days360Euro(x,u)}return 0},diffMonths:function(v,u){var t;t=(u.getFullYear()-v.getFullYear())*12;t-=v.getMonth()+1;t+=u.getMonth()+1;return t},days360:function(v,y,w,u,t,x){return((y-v)*360)+((u-w)*30)+(x-t)},days360Nasd:function(u,x,t,v){var w=u.getDate(),B=u.getMonth(),A=u.getFullYear(),z=x.getDate(),y=x.getMonth(),C=x.getFullYear();if((y==2&&this.isEndOfMonth(z,y,C))&&((B==2&&this.isEndOfMonth(w,B,A))||t==3)){z=30}if(z==31&&(w>=30||t==3)){z=30}if(w==31){w=30}if(v&&B==2&&this.isEndOfMonth(w,B,A)){w=30}return this.days360(A,C,B,y,w,z)},days360Euro:function(A,v){var t=A.getDate(),x=A.getMonth(),w=A.getFullYear(),y=v.getDate(),u=v.getMonth(),z=v.getFullYear();if(t==31){t=30}if(y==31){y=30}return this.days360(w,z,x,u,t,y)},isEndOfMonth:function(t,v,u){return t==(new b(u,v+1,0,23,59,59)).getDate()},isLeapYear:function(t){return new b(t,1,29).getMonth()==1},calcAnnualBasis:function(t,v,z){switch(z){case 0:case 2:case 4:return 360;case 3:return 365;case 1:var u=t.getDate(),B=t.getMonth(),y=t.getFullYear(),w=v.getDate(),x=v.getMonth(),C=v.getFullYear(),D=0;if(y==C){if(this.isLeapYear(y)){D=366}else{D=365}}else{if(((C-1)==y)&&((B>x)||((B==x)&&u>=w))){if(this.isLeapYear(y)){if(B<2||(B==2&&u<=29)){D=366}else{D=365}}else{if(this.isLeapYear(C)){if(x>2||(x==2&&w==29)){D=366}else{D=365}}else{D=365}}}else{for(var A=y;A<=C;A++){if(this.isLeapYear(A)){D+=366}else{D+=365}}D=D/(C-y+1)}}return D}return 0},lastDayOfMonth:function(t){t.setDate(0);return t.getDate()},isLastDayOfMonth:function(t){return(t.getDate()==this.lastDayOfMonth(t))}};var j=g.times={math:h,fromMath:function(v){var t={},u=this;t.hour=((v*24)+"").split(".")[0]*1;t.minute=function(w){w=u.math.round(w*24*100)/100;w=(w+"").split(".");var x=0;if(w[1]){if(w[1].length<2){w[1]+="0"}x=w[1]*0.6}return u.math.round(x)}(v);t.second=function(z){z=u.math.round(z*24*10000)/10000;z=(z+"").split(".");var x=0;if(z[1]){for(var y=0;y<4;y++){if(!z[1].charAt(y)){z[1]+="0"}}var w=((z[1]*0.006)+"").split(".");if(w[1]){if(w[1]&&w[1].length>2){w[1]=w[1].substr(0,2)}return u.math.round(w[1]*0.6)}}return x}(v);return t},fromString:function(v,z){var w=new b(),A=v,t,y,x,u,B;if(z){B=A.substr(-2).toLowerCase();A=A.replace(/(am|pm)/i,"")}A=A.split(":");y=A[0]*1;x=A[1]*1;u=(A[2]?A[2]:0)*1;if(z&&B=="pm"){y+=12}return m.TIME(y,x,u)}};e.extend(h,{log10:function(t){return h.log(t)/2.302585092994046},signum:function(t){return(t/h.abs(t))||t},log1p:function(t){var u=0,w=50;if(t<=-1){return"-INF"}if(t<0||t>1){return h.log(1+t)}for(var v=1;v<w;v++){if((v%2)===0){u-=h.pow(t,v)/v}else{u+=h.pow(t,v)/v}}return u}});e.print=function(t){};if(!Object.getPrototypeOf){Object.getPrototypeOf=function(t){return t||{}}}if(!Array.prototype.indexOf){e.sheet.max=60;Array.prototype.indexOf=function(v,w){for(var u=(w||0),t=this.length;u<t;u++){if(this[u]===v){return u}}return -1}}return k})(jQuery,document,window,Date,String,Number,Boolean,Math,RegExp,Error);